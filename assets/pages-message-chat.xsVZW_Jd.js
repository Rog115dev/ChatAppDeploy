var e,t=Object.defineProperty,s=(e,s,i)=>(((e,s,i)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i})(e,"symbol"!=typeof s?s+"":s,i),i);import{_ as i,o,c as a,g as n,G as l,M as c,u as r,s as d,q as u,$ as m,N as h,O as g,n as p,P as f,Q as _,R as x,T as y,z as k,r as b,C,w,a as M,K as I,L as v,l as T,e as j,U as L,t as S,m as $,f as N,b as B,d as U,F as E,V as R,W as O,X as A,j as F,i as D,Y as H,p as P,D as z,E as V,Z as q,a0 as J,J as Q,a1 as G,A as W,a2 as Y,a3 as K,B as X,a4 as Z,H as ee,a5 as te,x as se,a6 as ie,a7 as oe,a8 as ae}from"./index-37Su0qRO.js";import{_ as ne}from"./uni-icons.u6lZObLY.js";import{r as le}from"./uni-app.es.D58nOoD0.js";import{e as ce,_ as re}from"./emoji.h4LwiIow.js";import{_ as de}from"./uni-data-checkbox.DtBap3qN.js";import{_ as ue}from"./mp-html.BIObXj21.js";import{u as me}from"./user-select.BjZKB9Zf.js";import{i as he,a as ge,c as pe}from"./chat.DZQJFAVa.js";import{s as fe}from"./status.pdXc3RDC.js";const _e=i({data:()=>({isUserMedia:!1,stream:null,audio:null,recorder:null,chunks:[],startTime:0}),mounted(){-1===origin.indexOf("https")&&-1===origin.indexOf("localhost")&&-1===origin.indexOf("127.0.0.1")&&(this.$emit("error","100"),console.log("请在 https 环境中使用本插件。")),navigator.mediaDevices&&window.MediaRecorder||(this.$emit("error","101"),console.log("当前浏览器不支持"))},methods:{getRecorderManager(){this.audio=document.createElement("audio"),navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{this.isUserMedia=!0,e.getTracks().forEach((e=>{e.stop()}))})).catch((e=>{this.onErrorHandler(e)}))},start(){navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{this.startTime=(new Date).getTime(),this.stream=e,this.recorder=new MediaRecorder(e),this.recorder.ondataavailable=this.getRecordingData,this.recorder.onstop=this.saveRecordingData,this.recorder.start()})).catch((e=>{this.onErrorHandler(e)}))},stop(){this.recorder.stop(),this.stream.getTracks().forEach((e=>{e.stop()}))},getRecordingData(e){this.chunks.push(e.data)},saveRecordingData(){const e=new Blob(this.chunks,{type:"audio/mpeg"}),t=URL.createObjectURL(e);this.chunks=[];let s=((new Date).getTime()-this.startTime).toString().split("");s.splice(s.length-2),s.splice(s.length-1,0,"."),s=parseFloat(s.join(""));const i={data:e,duration:s,localUrl:t};this.$emit("success",i)},onErrorHandler(e){if(console.log(e),"NotAllowedError"===e.name)throw this.$emit("error","201"),"用户拒绝了当前的浏览器实例的访问请求";if("NotReadableError"===e.name)throw this.$emit("error","101"),"当前浏览器不支持";throw this.$emit("error","500"),"调用失败，原因不详"}},destroyed(){this.stop()}},[["render",function(e,t,s,i,l,c){const r=n;return o(),a(r,{class:"recorder"})}]]);class xe extends class{constructor(e){s(this,"messages"),this.messages={}}$fire(e,t={}){if(!this.messages[e])return;let s=this.messages[e].length;for(let i=0;i<s;i++)this.messages[e][i].call(this,{type:e,detail:t})}$on(e,t){this.messages[e]&&"function"==typeof t?this.messages[e].push(t):this.messages[e]=[t]}$off(e,t){if(this.messages[e]instanceof Array){let s=this.messages[e].length-1;for(;s>=0;s--)this.messages[e][s]===t&&this.messages[e].splice(s,1)}}}{constructor({context:t,maxCount:s}){super(),((e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)})(this,e,void 0),this.deftext="######################################################NBLSJ######################################################",this.ctx=t,this.maxCount=s,this.textCount=0,this.overstep=!1,this.timeoutArr=[],this.flagArr=[],this.isSetContents=!1}tool(e,t={}){return"function"==typeof this.ctx[e]&&this.ctx[e](t),this}ready(e){this.tool("setContents",{html:e})}format(e,t){return this.ctx.format(e,t),this}emoji(e){return this.tool("insertText",{text:e}),this}addLink({prefix:e="",suffix:t="",data:s={}}){this.tool("insertText",{text:this.deftext}).tool("blur").getContents().then((t=>{let i=t.delta.ops,o=[];for(let a=0;a<i.length;a++){let t=i[a];if(t.insert&&"object"!=typeof t.insert){if(t.insert.indexOf(this.deftext)>-1){t.attributes&&t.attributes.link&&delete t.attributes;let[n,l]=t.insert.split(this.deftext);if(o.push({...t,insert:n}),"object"!=typeof s||Array.isArray(s))s.forEach(((t,s)=>{let i={attributes:{link:`${t.user_id}`,textDecoration:"none",color:"#333",pointerEvents:"none"},insert:e+t.realname};o.push(i),o.push({insert:" "})}));else{let t={attributes:{link:`${s.user_id}`,textDecoration:"none",color:"#333",pointerEvents:"none"},insert:e+s.realname};o.push(t),o.push({insert:" "})}l&&o.push({...t,insert:l});let c=i.slice(a+1);o=[...o,...c];break}o.push(t)}else o.push(t)}this.ctx.setContents({delta:{ops:o},complete:()=>{this.format("fontFamily","inherit").input()}})})).catch((e=>l({title:"操作失败",icon:"error"})))}async getLink(){let{delta:{ops:e}}=await this.getContents(),t=[];return e.forEach((e=>{e.attributes&&e.attributes.link&&t.push(parseInt(e.attributes.link))})),t}addImage(e){const t=e=>(e.forEach((e=>{this.tool("insertImage",{src:e,alt:"IMAGE"}).tool("insertText",{text:"\n"})})),this.tool("scrollIntoView"),this);return e?t(e):c({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>t(e.tempFilePaths)})}async getImages(){let{delta:{ops:e}}=await this.getContents(),t=[];return e.forEach((e=>{e.attributes&&"IMAGE"===e.attributes.alt&&t.push(e.insert.image.replace(/data:image\/png;base64,/,""))})),t}async replaceImage(e){let t=await this.getContents(),s=JSON.stringify(t.delta.ops),i=t.delta.ops;for(let o of i)if("object"==typeof o.insert&&"image"in o.insert){let t=o.insert.image;o.insert.image=await e(t)}return s===JSON.stringify(i)?t:await this.tool("setContents",{delta:{ops:i}}).getContents()}getContents(){return new Promise(((e,t)=>{this.ctx.getContents({success:t=>{e(t)}})}))}upKeyboard(){return this.tool("blur").format("fontFamily","inherit"),this}eventLink(e){if(!e)return;let t=e.delta.ops||[];if(!(JSON.stringify(t).indexOf(this.deftext)>-1)){this.isSetContents=!1;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s.attributes&&s.attributes.link){let s=t[e+1].insert;if(s&&(0===s.indexOf("\\n")||0===s.indexOf(" ")))continue;t.splice(e,1,{insert:""}),this.isSetContents=!0;break}}this.isSetContents?(this.tool("blur"),this.ctx.setContents({delta:{ops:t},complete:()=>{this.input()}})):this.input(e)}}eventTextLenght(e){return this.textCount=e.text.length-1,!!(this.maxCount&&this.textCount>this.maxCount)}async input(e){e||(e=await this.getContents()),e.text.indexOf(this.deftext)<0&&(this.overstep=this.eventTextLenght(e),e.overstep=this.overstep,this.$fire("edit:input",e))}statuschange({detail:e}){e.link?this.ctx.blur():this.debounce((()=>{this.$fire("edit:statuschange",e)}),100,!1)}focus({detail:e}){this.debounce((()=>{this.input(e)}),100,!1)}blur({detail:e}){this.debounce((()=>{this.$fire("edit:blur",e)}),100,!1)}debounce(e,t=500,s=!0,i="default"){if(this.timeoutArr[i]||(this.timeoutArr[i]=null),null!==this.timeoutArr[i]&&clearTimeout(this.timeoutArr[i]),s){var o=!this.timeoutArr[i];this.timeoutArr[i]=setTimeout((function(){this.timeoutArr[i]=null}),t),o&&"function"==typeof e&&e()}else this.timeoutArr[i]=setTimeout((function(){"function"==typeof e&&e()}),t)}queryParamsReverse(e){let t=e||"",s=new Object,i=t.split("?")[1];if(null!=i){let e=i.split("&");for(let t=0;t<e.length;t++)s[e[t].split("=")[0]]=e[t].split("=")[1]}return s}queryParams(e={},t=!0,s="brackets"){let i=JSON.parse(JSON.stringify(e)),o=t?"?":"",a=[];-1==["indices","brackets","repeat","comma"].indexOf(s)&&(s="brackets");for(let n in i){let e=i[n];if(!(["",void 0,null].indexOf(e)>=0))if(e.constructor===Array)switch(s){case"indices":for(let s=0;s<e.length;s++)a.push(n+"["+s+"]="+e[s]);break;case"brackets":default:e.forEach((e=>{a.push(n+"[]="+e)}));break;case"repeat":e.forEach((e=>{a.push(n+"="+e)}));break;case"comma":let t="";e.forEach((e=>{t+=(t?",":"")+e})),a.push(n+"="+t)}else a.push(n+"="+e)}return a.length?o+a.join("&"):""}}e=new WeakMap;const ye=r(d),ke=u(d);const be=i({name:"im-input",components:{MumuRecorder:_e,userSelect:me},props:{boxStatus:{type:Number,default:0},contact:{type:Object,default:{}},morecheck:{type:Boolean,default:!1}},data:()=>({editorCtx:null,InputBottom:0,paddingB:0,footerHeight:50,boxHeight:300,uploading:!1,recShow:!1,inputMsg:"",recorderManager:null,recing:!1,recLength:1,recTimer:null,tmpVoice:"",isUseRecorder:!1,playItemIndex:-1,currentAudio:"",mainHeight:0,isCancel:!1,isH5:!1,isApp:!1,appBox:0,TabCur:0,emojiName:"",scrollLeft:0,emojiList:[],currentEmojiList:[],isFocus:!1,globalConfig:ke.globalConfig,userInfo:ke.userInfo,readOnly:!1,edit:null,modelName:!1,isAt:!1,quote:"",boardHeight:0}),watch:{boxStatus(e){this.readOnly=!1,this.appBox=0,this.InputBottom=0},appBox(e){0!=e||this.isFocus||(this.InputBottom=0)},InputBottom(e){this.$emit("setPad",e)}},created:function(){m("updateEmoji",(e=>{this.getEmojiList()})),this.currentEmojiList=ce[0].children,this.getEmojiList(),h({success:e=>{let t=e.windowHeight;this.mainHeight=t}}),this.isH5=!0},methods:{keyboardCallback(e){(0==this.appBox||e.height>0&&0==this.InputBottom)&&(this.boardHeight=e.height)},atClick(){g(),this.modelName="userModel"},msgItem(){return{id:this.$util.getUuid(),sendTime:(new Date).getTime(),status:"going",type:"text",content:"",is_read:0,is_group:0,file_id:0,file_cate:0,fileName:"",fileSize:0,extends:null}},at(){this.isAt=!0;let e=this.$refs.userSelect.selectUser;this.closeModel(),this.edit.addLink({prefix:"@",data:e}),setTimeout((()=>{this.getFocus()}),100)},sendContactCard(){let e=this.$refs.contactSelect.selectUser;if(1!=e.length)return l({icon:"none",title:"必须选择一位联系人"});this.closeModel();let t=e[0],s={type:"contact",status:"going",content:"[个人名片] "+t.displayName,extends:{avatar:t.avatar,displayName:t.displayName,id:t.id}};this.$emit("send",Object.assign(this.msgItem(),s),!1)},closeModel(){"userModel"==this.modelName&&(this.$refs.userSelect.selectUser=[],this.$refs.userSelect.changeUser=[]),this.modelName=""},insertText(e){this.editorCtx.setContents({html:e}).exec()},setAtList(e){this.isAt=!0,this.closeModel(),this.edit.addLink({prefix:"@",data:e})},getFocus(){this.editorCtx.format("fontFamily","inherit"),this.isFocus=!0},chooseDiyEmoji(e){let t={type:"emoji",content:e.src,file_id:e.file_id,status:"going"};this.$emit("send",Object.assign(this.msgItem(),t),!1)},chooseEmoji(e){this.editorCtx.insertImage({src:e.src,alt:e.title,width:18,height:18,nowrap:!0,extClass:"emoji-image",success:()=>{},complete:()=>{this.editorCtx.blur(),this.showAppBox(1)}})},tabSelect(e){this.TabCur=e.currentTarget.dataset.id,this.emojiName=e.currentTarget.dataset.name,this.scrollLeft=60*(e.currentTarget.dataset.id-1),this.currentEmojiList=this.emojiList[this.TabCur].children},showAppBox(e){this.appBox==e?(this.appBox=0,this.InputBottom=0,this.readOnly=!1):(this.appBox=e,this.InputBottom=this.boxHeight,this.recShow=!1,this.readOnly=!0)},showRec:function(){this.InputBottom=0,this.appBox=0,1==this.recShow?this.recShow=!1:this.recShow=!0},sendVoiceMsg:function(){if(""==this.tmpVoice)return void l({title:"录制已取消",icon:"none"});let e={localUrl:this.tmpVoice,duration:this.recLength};this.handlerSuccess(e),this.tmpVoice="",this.recLength=0},sendTextMsg:function(){1!=this.appBox&&(this.isFocus=!0),this.editorCtx.getContents({success:e=>{let t=e.html;if("<p><br></p>"==t)return!1;this.edit.getLink().then((e=>{let s={type:"text",content:t,extends:this.quote};this.quote.msg_id&&(s.pid=this.quote.msg_id,s.extends=this.quote);const i=Array.from(new Set(e));s.at=i,this.inputMsg="",this.closeQuote(),this.editorCtx.clear(),1!=this.appBox&&(this.getFocus(),setTimeout((()=>{this.isFocus=!0}),10)),this.$emit("send",Object.assign(this.msgItem(),s),"")}))},fail:e=>{this.inputMsg="",this.editorCtx.clear(),this.editorCtx.format("fontFamily","inherit"),console.info("错误")}})},uploadEmoji(){p({url:"/pages/message/emoji"})},chooseImg(){let e={type:"image",status:"going"};c({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:t=>{t.tempFiles.forEach((t=>{e.content=t.path,e.fileName=t.name,e.fileSize=t.size,this.$emit("send",Object.assign(this.msgItem(),e),t.path)}))}})},transfer(){p({url:"/pages/message/transfer?name="+this.contact.displayName+"&avatar="+this.contact.avatar+"&user_id="+this.contact.user_id})},chooseVideo:function(){let e={type:"video",status:"going"};f({sourceType:["camera","album"],compressed:!1,success:t=>{const s=t.tempFilePath;let i={duration:t.duration,width:t.width,height:t.height};e.fileName=t.name,e.fileSize=t.size,e.extends=i,e.content=s,this.$emit("send",Object.assign(this.msgItem(),e),s)}})},sendRed:function(){p({url:"/pages/message/red?is_group="+this.contact.is_group+"&toContactId="+this.contact.id})},chooseFile:function(){let e=this;_({count:5,success:function(t){e.appendFile(t)}})},appendFile(e){e.tempFiles.forEach((e=>{let t=e.path,s={type:"file",status:"going",fileName:e.name,fileSize:e.size,content:t},i=e.type;-1!=i.indexOf("image/")&&(s.type="image"),-1!=i.indexOf("video/")&&(s.type="video"),this.$emit("send",Object.assign(this.msgItem(),s),t)}))},chooseLocation(){x({success:e=>{console.log("位置名称："+e.name),console.log("详细地址："+e.address),console.log("纬度："+e.latitude),console.log("经度："+e.longitude);let t={type:"location",status:"going",content:"[位置]"+e.name,extends:e};this.$emit("send",Object.assign(this.msgItem(),t),!1)}})},calling(e){if(!parseInt(this.globalConfig.chatInfo.webrtc))return l({title:"未开启音视频通话",icon:"none"});if(!parseInt(this.globalConfig.chatInfo.simpleChat))return l({title:"系统已关闭私聊",icon:"none"});if(ye.webrtcLock)return l({title:"其他终端正在通话中",icon:"none"});let t=this.$util.getUuid();p({url:"/pages/message/call?msg_id="+t+"&type="+e+"&status=1&id="+this.contact.id+"&name="+this.contact.displayName+"&avatar="+encodeURI(this.contact.avatar)})},changeMsgText(e){this.isAt&&(this.edit.eventLink(e.detail),this.edit.isSetContents&&setTimeout((()=>{this.getFocus()}),200));""==(e.detail.text?e.detail.text.replace(/\n/g,""):"")&&"<p><br></p>"==e.detail.html?this.inputMsg="":this.inputMsg=e.detail.html},onEditorReady(){y().in(this).select("#editor").context((e=>{this.edit=new xe({context:e.context,maxCount:300}),this.editorCtx=e.context})).exec()},InputFocus(e){this.isFocus=!0,this.appBox>0&&(this.appBox=0),this.InputBottom=0},getInputTop(){const e=this.$util.getQuery();setTimeout((()=>{e.select("#editor").boundingClientRect(),e.exec((e=>{this.boardHeight>0&&(this.mainHeight-this.boardHeight>e[0].top?this.InputBottom=0:this.InputBottom=this.boardHeight)}))}),10)},InputBlur(e){this.appBox||this.isFocus||(this.InputBottom=0),setTimeout((()=>{this.isFocus=!1}),10)},startRecorder(){console.log("录音开始..."),this.$refs.recorderRef.start(),this.isUseRecorder=!0},endRecorder(){console.log("录音结束"),this.$refs.recorderRef.stop(),this.isUseRecorder=!1},cancelRecorder(){this.endRecorder(),this.isCancel=!0},moveRecorder(e){e.touches[0].clientY<this.mainHeight-80?this.isCancel=!0:this.isCancel=!1},handlerSuccess(e){if(this.checkRecorder(e.duration),this.isCancel)return this.isCancel=!1,console.log("录音已取消");let t={type:"voice",content:e.localUrl,fileName:this.$util.getUuid()+".mp3",extends:{duration:e.duration}};this.$emit("send",Object.assign(this.msgItem(),t))},checkRecorder(e){if(e<1||isNaN(e)||!e)return this.recLength=0,this.tmpVoice="",this.recing=!1,this.isCancel=!0,l({title:"录音时间太短",icon:"error"})},handlerError(e){if("201"===e)k({content:"麦克风权限被拒绝，请刷新页面后授权麦克风权限。"});else console.log("录音功能受限，请知晓！")},closeQuote(){this.quote=""},quoteMessage(e){this.quote=e,1==this.contact.is_group&&e.user_id!=this.userInfo.user_id&&this.setAtList({user_id:e.user_id,realname:e.realname})},getEmojiList(){this.$api.emojiApi.emojiList({}).then((e=>{0==e.code&&(ce[1].children=e.data,1==this.TabCur&&(this.currentEmojiList=e.data)),this.emojiList=ce}))}}},[["render",function(e,t,s,i,l,c){const r=n,d=R,u=le(b("mumu-recorder"),_e),m=O,h=A,g=F,p=D,f=C("user-select");return o(),a(r,{id:"more-oprate"},{default:w((()=>[M(r,{class:T(["im-footer bg-gray",[s.morecheck?"hide-im-footer":"show-im-footer"]]),style:N([{paddingBottom:l.paddingB+"px",bottom:l.InputBottom+"px"}])},{default:w((()=>[I(M(r,{class:T(["im-menus f-28",[l.recShow?"cuIcon-keyboard":"cuIcon-sound"]]),style:{"margin-bottom":"8rpx"},"hover-class":"tap",onClick:c.showRec},null,8,["class","onClick"]),[[v,!l.isFocus||!s.contact.is_group]]),I(M(r,{class:"im-menus f-24",style:{"margin-bottom":"13rpx"},onClick:c.atClick},{default:w((()=>[j("@ ")])),_:1},8,["onClick"]),[[v,l.isFocus&&1==s.contact.is_group]]),M(r,{class:"im-flex1 im-msgarea"},{default:w((()=>[I(M(d,{id:"editor",class:"solid-bottom bg-white im-input c-333","adjust-position":!1,maxlength:"300","cursor-spacing":"10",onFocus:c.InputFocus,onBlur:c.InputBlur,onInput:c.changeMsgText,onReady:c.onEditorReady,"read-only":l.readOnly},null,8,["onFocus","onBlur","onInput","onReady","read-only"]),[[v,0==l.recShow]]),I(M(r,{class:"toolBox"},{default:w((()=>[M(r,{class:T(["recorder",{active:l.isUseRecorder}]),onTouchstart:L(c.startRecorder,["prevent"]),onTouchend:L(c.endRecorder,["prevent"]),onTouchmove:L(c.moveRecorder,["prevent"]),onTouchcancel:c.cancelRecorder},{default:w((()=>[j(S(l.isUseRecorder?"松开结束":"按住说话"),1)])),_:1},8,["class","onTouchstart","onTouchend","onTouchmove","onTouchcancel"])])),_:1},512),[[v,1==l.recShow]]),l.quote?(o(),a(r,{key:0,class:"im-flex im-space-between message-quote radius-6 im-align-items-center"},{default:w((()=>[M(r,{class:"text-overflow"},{default:w((()=>[j(S(l.quote.content),1)])),_:1}),M(r,{class:"cuIcon-close",onClick:c.closeQuote},null,8,["onClick"])])),_:1})):$("",!0)])),_:1}),l.isH5?(o(),a(u,{key:0,ref:"recorderRef",onSuccess:c.handlerSuccess,onError:c.handlerError},null,8,["onSuccess","onError"])):$("",!0),M(r,{class:"im-flex im-justify-content-start im-align-items-center",style:{"margin-bottom":"8rpx"}},{default:w((()=>[M(r,{class:"im-menus cuIcon-emoji f-28 ml-5","hover-class":"tap",onClick:t[0]||(t[0]=e=>c.showAppBox(1))}),l.inputMsg?$("",!0):(o(),a(r,{key:0,class:"im-menus cuIcon-roundadd f-28 mr-10","hover-class":"tap",onClick:t[1]||(t[1]=e=>c.showAppBox(2))})),l.inputMsg?(o(),a(r,{key:1},{default:w((()=>[M(m,{class:"cu-btn bg-green shadow mr-10",onTouchend:L(c.sendTextMsg,["prevent"])},{default:w((()=>[j("发送")])),_:1},8,["onTouchend"])])),_:1})):$("",!0)])),_:1}),1==l.appBox?(o(),a(r,{key:1,class:"im-flex im-columns im-emoji-box",style:N([{height:l.boxHeight+"px"}])},{default:w((()=>[M(h,{"scroll-x":"",class:"bg-gray nav im-emoji-header","scroll-with-animation":"","scroll-left":l.scrollLeft},{default:w((()=>[(o(!0),B(E,null,U(l.emojiList,((e,t)=>(o(),a(r,{class:T(["cu-item",t==l.TabCur?"text-green":""]),key:t,onClick:c.tabSelect,"data-id":t,"data-name":e.name},{default:w((()=>[M(r,{class:T([[e.icon],"f-20"])},null,8,["class"])])),_:2},1032,["class","onClick","data-id","data-name"])))),128))])),_:1},8,["scroll-left"]),M(h,{"scroll-y":"",class:"bg-white im-emoji-body"},{default:w((()=>[M(r,{class:T(["im-flex im-wrap im-justify-content-start im-align-items-center pd-10","favors"==l.emojiName?" cu-list grid col-5":""])},{default:w((()=>["favors"==l.emojiName?(o(),a(r,{key:0,class:"im-emoji-item"},{default:w((()=>[M(r,{class:"upload-emoji",onClick:c.uploadEmoji},{default:w((()=>[M(g,{class:"cuIcon-add c-999",style:{"vertical-align":"sub"}})])),_:1},8,["onClick"])])),_:1})):$("",!0),(o(!0),B(E,null,U(l.currentEmojiList,((e,t)=>(o(),a(r,{class:"im-emoji-item",key:t},{default:w((()=>["favors"==l.emojiName?(o(),a(p,{key:0,src:e.src,style:{width:"100rpx"},mode:"widthFix","fade-show":!1,"lazy-load":"",onClick:t=>c.chooseDiyEmoji(e)},null,8,["src","onClick"])):(o(),a(p,{key:1,src:e.src,style:{width:"44rpx"},mode:"widthFix","lazy-load":"",onClick:t=>c.chooseEmoji(e)},null,8,["src","onClick"]))])),_:2},1024)))),128))])),_:1},8,["class"])])),_:1})])),_:1},8,["style"])):$("",!0),2==l.appBox?(o(),a(r,{key:2,class:"im-flex im-app-box im-flex im-justify-content-start im-wrap im-align-content-start pd-20",style:N([{height:l.boxHeight+"px"}])},{default:w((()=>[M(r,{class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:c.chooseImg},{default:w((()=>[M(r,{class:"bg-white cuIcon-album f-24 radius-10 im-app-item-icon"}),M(r,{class:"mt-5"},{default:w((()=>[j("照片")])),_:1})])),_:1},8,["onClick"]),M(r,{class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:c.chooseVideo},{default:w((()=>[M(r,{class:"bg-white cuIcon-video f-24 radius-10 im-app-item-icon"}),M(r,{class:"mt-5"},{default:w((()=>[j("视频")])),_:1})])),_:1},8,["onClick"]),M(r,{class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:c.sendRed},{default:w((()=>[M(r,{class:"bg-white cuIcon-addressbook f-24 radius-10 im-app-item-icon"}),M(r,{class:"mt-5"},{default:w((()=>[j("红包")])),_:1})])),_:1},8,["onClick"]),s.contact.is_group?$("",!0):(o(),a(r,{key:0,class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:c.transfer},{default:w((()=>[M(r,{class:"bg-white cuIcon-addressbook f-24 radius-10 im-app-item-icon"}),M(r,{class:"mt-5"},{default:w((()=>[j("转账")])),_:1})])),_:1},8,["onClick"])),M(r,{class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:c.chooseFile},{default:w((()=>[M(r,{class:"bg-white cuIcon-file f-24 radius-10 im-app-item-icon"}),M(r,{class:"mt-5"},{default:w((()=>[j("文件")])),_:1})])),_:1},8,["onClick"]),!s.contact.is_group&&(l.isH5||l.isApp)&&parseInt(l.globalConfig.chatInfo.webrtc)?(o(),a(r,{key:1,class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:t[2]||(t[2]=e=>c.calling(0))},{default:w((()=>[M(r,{class:"bg-white cuIcon-dianhua f-24 radius-10 im-app-item-icon"}),M(r,{class:"mt-5"},{default:w((()=>[j("语音通话")])),_:1})])),_:1})):$("",!0),!s.contact.is_group&&(l.isH5||l.isApp)&&parseInt(l.globalConfig.chatInfo.webrtc)?(o(),a(r,{key:2,class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:t[3]||(t[3]=e=>c.calling(1))},{default:w((()=>[M(r,{class:"bg-white cuIcon-record f-24 radius-10 im-app-item-icon"}),M(r,{class:"mt-5"},{default:w((()=>[j("视频通话")])),_:1})])),_:1})):$("",!0),M(r,{class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:t[4]||(t[4]=e=>l.modelName="contactModel")},{default:w((()=>[M(r,{class:"bg-white cuIcon-addressbook f-24 radius-10 im-app-item-icon"}),M(r,{class:"mt-5"},{default:w((()=>[j("名片")])),_:1})])),_:1})])),_:1},8,["style"])):$("",!0)])),_:1},8,["class","style"]),I(M(r,{class:"voice-model c-white radius-10 im-flex im-columns im-align-items-center pd-10"},{default:w((()=>[M(r,{class:T(["cuIcon-voicefill mt-15 mb-5 f-28",[l.isCancel?"c-red":"voice-icon"]])},null,8,["class"]),M(r,{class:T([l.isCancel?"c-red":""])},{default:w((()=>[j(S(l.isCancel?"松开取消":"正在录音"),1)])),_:1},8,["class"])])),_:1},512),[[v,l.isUseRecorder]]),M(r,{class:T(["cu-modal bottom-modal","userModel"==l.modelName?"show":""]),onClick:t[8]||(t[8]=e=>c.closeModel())},{default:w((()=>["userModel"==l.modelName?(o(),a(r,{key:0,class:"cu-dialog"},{default:w((()=>[M(r,{class:"cu-bar bg-white"},{default:w((()=>[M(r,{class:"action text-gray",onClick:t[5]||(t[5]=e=>c.closeModel())},{default:w((()=>[j("取消")])),_:1}),M(r,{class:"f-16"},{default:w((()=>[j("选择提醒的人")])),_:1}),M(r,{class:"action text-green",onClick:t[6]||(t[6]=e=>c.at())},{default:w((()=>[j("完成")])),_:1})])),_:1}),M(r,{class:"manage-content",style:{height:"500px"},onClick:t[7]||(t[7]=L((()=>{}),["stop"]))},{default:w((()=>[M(h,{style:{height:"500px"},"scroll-y":"true"},{default:w((()=>[1==s.contact.is_group?(o(),a(f,{key:0,type:4,contact_id:s.contact.id,ref:"userSelect",onSetData:c.setAtList},null,8,["contact_id","onSetData"])):$("",!0)])),_:1})])),_:1})])),_:1})):$("",!0)])),_:1},8,["class"]),M(r,{class:T(["cu-modal bottom-modal","contactModel"==l.modelName?"show":""]),onClick:t[12]||(t[12]=e=>c.closeModel())},{default:w((()=>["contactModel"==l.modelName?(o(),a(r,{key:0,class:"cu-dialog"},{default:w((()=>[M(r,{class:"cu-bar bg-white"},{default:w((()=>[M(r,{class:"action text-gray",onClick:t[9]||(t[9]=e=>c.closeModel())},{default:w((()=>[j("取消")])),_:1}),M(r,{class:"f-16"},{default:w((()=>[j("选择分享的联系人")])),_:1}),M(r,{class:"action text-green",onClick:t[10]||(t[10]=e=>c.sendContactCard())},{default:w((()=>[j("完成")])),_:1})])),_:1}),M(r,{class:"manage-content",style:{height:"500px"},onClick:t[11]||(t[11]=L((()=>{}),["stop"]))},{default:w((()=>[M(h,{style:{height:"500px"},"scroll-y":"true"},{default:w((()=>[M(f,{type:1,multiple:!1,contact_id:s.contact.id,ref:"contactSelect"},null,8,["contact_id"])])),_:1})])),_:1})])),_:1})):$("",!0)])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-e28a8e5b"]]);const Ce=i({methods:{forward(){this.$emit("forward")},delete(){this.$emit("delete")}}},[["render",function(e,t,s,i,l,c){const r=F,d=n;return o(),a(d,{class:"operate"},{default:w((()=>[M(d,{onClick:c.forward},{default:w((()=>[M(r,{class:"cuIcon-forward"})])),_:1},8,["onClick"])])),_:1})}],["__scopeId","data-v-e0d7b579"]]),we=H(),Me=r(d),{newMessage:Ie,msgList:ve,getContact:Te,appendMsg:je,checkMsg:Le,unread:Se}=P(Me),$e=u(d);const Ne=i({components:{imInput:be,imItem:he,imUser:ge,statusPoint:fe,moreoperate:Ce},mixins:[pe],data:()=>({notForward:["transfer","voice","red"],user:$e.userInfo,contact:{},is_group:0,boxStatus:0,paddingT:0,video:"",videoUrl:"",InputBottom:0,player:null,playIndex:-1,emojiMap:[],fileExt:[],page:1,limit:10,moreData:!0,newMessage:Ie,messageList:ve,newheight:0,scrollTop:0,loading:"more",loadLock:!1,scrollHeight:0,paddingB:0,contact_id:0,bottomHeight:50,globalConfig:$e.globalConfig,modelName:"",curMsg:"",curIndex:0,isSending:!1,copyTxt:"文本",wsData:null,timer:null,lastTapDiffTime:0,isProfile:!1,islongPress:!1,listTouchStart:0,groupInfo:{groupUserCount:0,virtual_count:0},atMsgList:[],atCount:0,unread:Se,isBottom:!0,morecheck:!1,selectMessage:[],windowsState:"",redenvelopeData:{},luckbtn:"",autoTranslate:!1,curParam:{}}),computed:{scrollH:function(){let e=z(),t=750/e.windowWidth,s=V(100);this.bottomHeight=s;const i=this.$util.getQuery();return setTimeout((()=>{i.select(".cu-header").boundingClientRect(),i.exec((e=>{this.paddingT=e[0].height}))}),10),parseInt((e.windowHeight-this.navBarHeight-this.paddingT)*t)}},watch:{newMessage(e){e.toContactId==this.contact.id&&e.fromUser.id!=this.user.user_id&&this.$api.msgApi.setMsgIsRead({toContactId:this.contact.id,is_group:this.contact.is_group,messages:e,fromUser:e.fromUser.id}),1===this.is_group&&this.getGroupInfo(),this.isBottom&&this.scrollToBottom()}},onLoad(e){Me.msgList=[];let t=Me.getContact(e.id);if(!t)return void l({title:"联系人不存在",icon:"none",duration:1500,complete:e=>{q({url:"/pages/index/index"})}});J(),this.curParam={};let s=location.href;this.curParam=this.$util.parseUrl(s),1==t.is_group&&(t.role<3||"1"==t.setting.profile)&&(this.isProfile=!0),this.contact=t,this.contact_id=e.id,this.is_group=t.is_group,this.getMessageList(),1==t.is_group&&this.getGroupInfo();let i=Me.unread;t.unread>0&&(Me.updateContacts({id:e.id,unread:0}),Me.unread=i-t.unread),m("getPositonsOrder",(e=>{let t=JSON.parse(JSON.stringify(e)).data;switch(e.type){case"isRead":for(let e=0;t.length>e;e++){const s={id:t[e].id,is_read:1};this.updateMessage(s)}break;case"readAll":t.toContactId==this.contact.id&&0==this.is_group&&this.messageList.forEach((e=>{e.is_read=1}));break;case"isOnline":t.id==this.contact.id&&(this.contact.is_online=t.is_online);break;case"undoMessage":if(t.from_user==this.user.user_id&&1==t.isMobile&&(new Date).getTime()-t.sendTime<1e3*this.globalConfig.chatInfo.redoTime)return!1;this.updateMessage(t);break;case"delMessage":this.messageList=this.messageList.filter((e=>e.id!=t.id));break;case"updateMessage":this.updateMessage(t);break;case"atMsgList":case"simple":case"group":case"webrtc":case"removeUser":case"clearMessage":case"delMessage":if("atMsgList"==e.type)return void(t.toContactId==this.curParam.id&&(this.atMsgList=t.list,this.atCount=t.count));if("removeUser"==e.type)return void(t.group_id==this.curParam.id&&t.user_id==this.user.user_id&&l({title:"您已被移出群聊！",icon:"none",complete:()=>{q({url:"/pages/index/index"})}}));if("clearMessage"==e.type)return void(t.group_id==this.curParam.id&&(this.messageList=[],Me.updateContacts({id:t.group_id,lastContent:""})));if("delMessage"==e.type)return void(t.group_id==this.curParam.id&&(this.messageList=this.messageList.filter((e=>e.id!=t.id))));if("webrtc"==t.type){if(!["calling","hangup","otherOpt"].includes(t.extends.event))return!1;"calling"==t.extends.event&&(this.wsData=t);let e=parseInt(t.extends.code);if([902,903,904,905,906,907].includes(e)){let e=this.wsData||t;e.content=t.content,t=e}}let s=!1;if(1==t.is_group?t.toContactId==this.curParam.id&&(s=!0):(t.toContactId==this.curParam.id||t.fromUser.id==this.user.user_id&&t.toUser==this.curParam.id)&&(s=!0),s){let e=Me.getContact(this.contact_id,t);if(!e)break;Me.checkMsg(t),Me.appendMsg(t),this.autoTranslate&&"voice"==t.type&&setTimeout((()=>{this.curMsg=t,this.translateVoice()}),1e3);let s=e.is_at;t.at.includes(this.user.user_id)&&(0!==Me.msgAt&&(Me.msgAt-=1),s=0===e.is_at?e.is_at:e.is_at-1),Me.updateContacts({id:this.curParam.id,unread:0,is_at:s})}}}))},onUnload(){Me.msgList=[],we.stop(),Q("socketStatus"),this.curParam={}},beforeDestroy(){Q("socketStatus")},onBackPress(e){return this.InputBottom=0,G({url:"/pages/index/index"}),!0},onShow(){if(this.socketIo.send({type:"ping"}),this.is_group){let e=Me.getContact(this.contact_id);this.groupInfo.virtual_count=parseInt(e.virtual_count)}},created:function(){let e=[];ce.forEach((function(t){let s=t.children;s.length>0&&s.forEach((function(t){let s=t.name,i=t.src;e[s]=i}))})),this.emojiMap=e,we.onPlay((()=>{console.info("play")})),we.onEnded((()=>{we.stop(),this.playIndex=-1})),we.onError((e=>{console.info(e)}))},mounted(){m("socketStatus",(e=>{e&&(this.page=1,this.getMessageList(),1==this.is_group&&this.getGroupInfo())}))},methods:{download(e){W(),Y({timeout:3e4,header:{"Content-Type":"video/mp4"},url:e.content,success:e=>{K({filePath:e.tempFilePath,success:e=>{X(),l({title:"保存成功",duration:2e3})},fail(){X(),l({title:"保存失败",duration:2e3})}})},fail(){X(),l({title:"保存失败",duration:2e3})}})},discard(){},BackPage(){Z({delta:1})},checkMesssage(e){this.selectMessage=e.detail.value},cancelMoreHandle(){this.morecheck=!1,this.messageList.forEach((e=>{e.checked=!1})),this.selectMessage=[]},setMoreCheck(e){this.morecheck&&(-1==this.selectMessage.indexOf(e.msg_id)?this.selectMessage.push(e.msg_id):this.selectMessage.splice(this.selectMessage.indexOf(e.msg_id),1))},moreCheckHandle(){this.morecheck=!0},setMessageCheckValue(e){e.checked=!1},forwardMessage(){0!=this.selectMessage.length?(p({url:"/pages/index/userSelection?contact_id="+this.contact_id+"&type=3&msg_ids="+this.selectMessage.join(",")}),this.cancelMoreHandle()):l({title:"请选择消息",icon:"none"})},at(e){0!=this.contact.is_group&&this.user.user_id!=e.id&&(e.user_id=e.id,this.$refs.imInput.setAtList(e))},openAtModel(){this.modelName="atModel";let e=Me.msgAt,t=this.atCount;this.$api.msgApi.readAtMsg({toContactId:this.contact_id}).then((s=>{0==s.code&&(Me.msgAt=e-t,Me.updateContacts({id:this.contact_id,is_at:0}),this.atCount=0)}))},calling(e){this.$refs.imInput.calling(parseInt(e))},endTimer(){clearTimeout(this.timer),setTimeout((()=>{this.islongPress=!1}),200)},dblclick(e){if("text"!==e.type)return;const t=(new Date).getTime(),s=this.lastTapDiffTime;this.lastTapDiffTime=t;t-s<300&&(this.curMsg=e,this.modelName="copyModel")},getTime:()=>(new Date).getTime(),setPad(e){this.paddingB=e,this.scrollToBottom()},getGroupInfo(){this.$api.msgApi.groupInfo({group_id:this.contact_id}).then((e=>{0==e.code&&this.$set(this,"groupInfo",e.data)}))},updateMessage(e){let t=this.messageList;t.forEach(((s,i)=>{let o=t[i];s.id==e.id&&(t[i]=Object.assign(o,e)),s.hasOwnProperty("checked")||this.setMessageCheckValue(s)})),this.messageList=t},getScrollHeight(){const e=this.$util.getQuery();setTimeout((()=>{e.select(".cu-chat").boundingClientRect(),e.exec((e=>{this.scrollHeight=e[0].height,this.scrollTop=e[0].height-this.newheight,this.loadLock=!1}))}),10)},scrollChat(e){const t=e.detail,s=t.scrollTop,i=t.scrollHeight;this.newheight=i,s<10&&0==this.loadLock&&(this.loadLock=!0,this.page++,this.moreData&&(this.loading="loading",this.getMessageList()));y().in(this).select(".scroll-view-body").boundingClientRect((e=>{e&&(this.isBottom=s+e.height+2>=i)})).exec()},getMessageList(){let e={is_group:this.is_group,toContactId:this.contact.id,page:this.page,limit:this.limit};this.$api.msgApi.getMessageList(e).then((e=>{1==this.page&&(Me.msgList=[]),e.data.slice().reverse().forEach((e=>{this.setMessageCheckValue(e),Me.msgList.unshift(e)})),this.loading="more",e.data.length<this.limit&&(this.moreData=!1,this.loading="noMore"),this.$nextTick((()=>{1==this.page?this.scrollToBottom():this.getScrollHeight();const t=y().in(this),s=y().in(this);t.select(".checkbox-group-container").boundingClientRect((t=>{const i=t.height;s.select(".scroll-view-body").boundingClientRect((t=>{t.height>i&&e.data.length>=this.limit&&(this.page++,this.getMessageList())})).exec()})).exec()}))}))},moreOption(e,t,s){this.timer=setTimeout((()=>{this.curMsg=t,this.curIndex=s,"text"==t.type?this.copyTxt="消息":"image"==t.type?this.copyTxt="图片链接":this.copyTxt="文件链接","move"!=this.islongPress&&(this.islongPress=!0,this.modelName="moreOpt")}),1e3)},ListTouchMove(e){this.islongPress="move"},undoMsg(){let e=this.curMsg;this.modelName="",this.$api.msgApi.undoMessage({id:e.id}).then((t=>{const s={id:e.id,type:"event",is_undo:1,content:"你撤回了一条消息",oldContent:e.content,toContactId:e.toContactId};this.updateMessage(s)}))},delMsg(){let e=this.curMsg;this.modelName="",k({title:"删除消息会从所有人的聊天记录中抹掉，是否确定?",success:t=>{t.confirm&&this.$api.msgApi.delMessage({id:e.id}).then((e=>{0==e.code&&this.messageList.splice(this.curIndex,1)}))}})},copyMsg(){let e=this.$util.htmlToLines(this.curMsg.content);ee({data:e,showToast:!0}),this.modelName="",this.curMsg=""},colEmoji(){let e=this.curMsg;this.$api.emojiApi.addEmoji({file_id:e.file_id}).then((e=>{0==e.code&&this.$refs.imInput.getEmojiList()}))},forwardMsg(){p({url:"/pages/index/userSelection?contact_id="+this.contact_id+"&type=3"})},quoteMsg(){let e=this.curMsg,t=e.content.replace(/<[^>]+>/g,"");"text"!=e.type&&(t=this.$util.getMsgType(e.type));let s={msg_id:e.msg_id,content:e.fromUser.displayName+"："+t,user_id:e.fromUser.id,realname:e.fromUser.displayName};this.$refs.imInput.quoteMessage(s)},translateVoice(){this.autoTranslate||(this.autoTranslate=!0);let e=this.curMsg;this.$api.msgApi.asr({msg_id:e.msg_id}).then((t=>{e.voice_text=t.data,this.updateMessage(e)}))},editMsg(){let e=this.curMsg,t=e.content.replace(/<[^>]+>/g,"");"text"!=e.type&&(t=this.$util.getMsgType(e.type));let s={re_edit:!0,msg_id:e.msg_id,content:e.fromUser.displayName+"："+t,user_id:e.fromUser.id,realname:e.fromUser.displayName};this.$refs.imInput.quoteMessage(s),this.$refs.imInput.inputMsg=" ",this.$refs.imInput.insertText(this.curMsg.content),this.$refs.imInput.isFocus=!0},reEdit(e){this.$refs.imInput.inputMsg=" ",this.$refs.imInput.insertText(e),this.$refs.imInput.isFocus=!0},scrollToBottom(){this.scrollTop=99999999;const e=this.$util.getQuery();setTimeout((()=>{e.select(".cu-chat").boundingClientRect(),e.exec((e=>{let t=999999;e[0]&&(t=e[0].height),this.scrollTop=t+3e3}))}),10)},openDetails(){p({url:"/pages/message/detail?id="+this.contact.id+"&is_group="+this.contact.is_group})},reSend(e){e.status="going",this.sendMessage(JSON.parse(JSON.stringify(e)),"",!0)},toTransfer(e){p({url:"/pages/message/transfer_detail?msg_id="+e.msg_id})},openRedEnvelope(e,t){e.is_get||e.is_done?this.toDetails(e.msg_id):this.$api.msgApi.getHongbaoDetail({msg_id:e.msg_id}).then((s=>{s.data.is_get||s.data.is_done?this.toDetails(e.msg_id):0==s.code&&(this.windowsState="show",this.redenvelopeData=e.extends,this.redenvelopeData.msg_id=e.msg_id,this.redenvelopeData.index=t)}))},openRed(e){let t=this;t.luckbtn="luckbtn",this.$api.msgApi.getHongBao(e).then((s=>{0==s.code?(t.messageList[e.index].is_get=1,t.$forceUpdate(),setTimeout((function(){t.luckbtn="",t.closeRedEnvelope(),t.toDetails(e.msg_id)}),1e3)):(t.luckbtn="",t.closeRedEnvelope(),l({title:s.msg,icon:"none"}))})).catch((e=>{setTimeout((function(){t.luckbtn="",t.closeRedEnvelope()}),1e3)}))},toDetails(e){p({url:"/pages/message/red_detail?msg_id="+e})},closeRedEnvelope(){this.windowsState="hide",setTimeout((()=>{this.windowsState=""}),200)},sendMessage(e,t,s=!1){if(!this.nospeak())return void l({title:"群已开启禁言，无法发送消息",icon:"none"});let i=this.curMsg;if(e.extends&&e.extends&&e.extends.re_edit)return void this.$api.msgApi.updateMessageContent({msg_id:i.msg_id,content:e.content}).then((t=>{0==t.code&&(i.content=e.content,this.updateMessage(i))})).catch((t=>{this.sendFailed(e)}));let o=this.user;o.id=o.user_id,e.fromUser=o,e.from_user=this.user.user_id,e.toContactId=this.contact.id,e.is_group=this.contact.is_group,s||(e.hasOwnProperty("checked")||this.setMessageCheckValue(e),"voice"!=e.type&&this.messageList.push(e)),this.scrollToBottom();if(["text","location","contact","emoji"].includes(e.type))this.$api.msgApi.sendMessage(e).then((t=>{0==t.code?this.updateMessage(t.data):401==t.code?(this.messageList.pop(),l({title:t.msg,icon:"none"})):this.sendFailed(e)})).catch((t=>{this.sendFailed(e)}));else if(["image","file","video","voice"].includes(e.type)){let t=this.globalConfig.fileUpload.size??10;if(e.fileSize>1024*t*1024)return l({title:"文件大小不能超过"+t+"M",icon:"error"});te({url:this.$api.msgApi.uploadUrl,filePath:e.content,name:"file",header:{Authorization:se("authToken")},formData:{message:JSON.stringify(e)},success:t=>{let s=JSON.parse(t.data);0==s.code?this.updateMessage(s.data):401==s.code?(this.messageList.pop(),l({title:s.msg,icon:"none"})):this.sendFailed(e)},fail:t=>{this.sendFailed(e)}})}},sendFailed(e){e.status="failed",this.updateMessage(JSON.parse(JSON.stringify(e)))},playNow:function(e,t){return this.playIndex=t,we.autoplay=!0,we.src=e,we.play(),!0},playVoice:function(e){var t=e.currentTarget.dataset.voice,s=e.currentTarget.dataset.index;if(-1==this.playIndex)return this.playNow(t,s);this.playIndex==s?(we.stop(),this.playIndex=-1):(we.stop(),this.playIndex=-1,this.playNow(t,s))},closeInput(e){this.boxStatus++},nospeak(){return!(1==this.is_group&&this.contact.setting.nospeak>0)||(1==this.contact.setting.nospeak&&this.contact.role<3||2==this.contact.setting.nospeak&&1==this.contact.role)}}},[["render",function(e,t,s,i,l,c){const r=le(b("uni-icons"),ne),d=n,u=C("statusPoint"),m=F,h=C("cu-custom"),g=le(b("uni-notice-bar"),re),p=le(b("uni-load-more"),de),f=C("im-user"),_=le(b("mp-html"),ue),x=D,y=C("imItem"),k=ae,I=ie,v=A,R=C("imInput"),O=C("moreoperate");return o(),a(d,{class:"app-container"},{default:w((()=>[M(h,{bgColor:"bg-white",class:"cu-header"},{backText:w((()=>[M(r,{class:T(["message-back",[l.morecheck?"hide-arrow":"show-arrow"]]),onClick:c.BackPage,type:"left",size:"25",color:"#666666"},null,8,["class","onClick"]),l.unread>0&&l.unread<100?(o(),a(d,{key:0,class:T([[l.morecheck?"hide-arrow":"show-arrow"],"back-unread"])},{default:w((()=>[j(S(l.unread?l.unread:0),1)])),_:1},8,["class"])):$("",!0),M(d,{onClick:c.cancelMoreHandle,class:T([[l.morecheck?"show-btn":""],"cancel-btn"])},null,8,["onClick","class"]),l.unread>100?(o(),a(d,{key:1,class:"back-unread"},{default:w((()=>[j("99+")])),_:1})):$("",!0)])),content:w((()=>[M(d,{class:"im-flex im-justify-content-center im-align-items-center"},{default:w((()=>[0==l.is_group&&1==l.contact.is_online&&l.globalConfig.chatInfo&&1==l.globalConfig.chatInfo.online?(o(),a(u,{key:0,type:"success"})):$("",!0),M(m,{class:"text-overflow"},{default:w((()=>[j(S(l.contact.displayName),1)])),_:1}),1==l.is_group?(o(),a(m,{key:1},{default:w((()=>[j("("+S(l.groupInfo.groupUserCount+(l.groupInfo.virtual_count?l.groupInfo.virtual_count:0))+")",1)])),_:1})):$("",!0)])),_:1})])),right:w((()=>[l.is_group<2?(o(),a(d,{key:0,class:"cuIcon-more mr-10 f-16",onClick:c.openDetails},null,8,["onClick"])):$("",!0)])),_:1}),1==l.is_group&&l.groupInfo.notice?(o(),a(g,{key:0,"show-icon":"",scrollable:"",showClose:"",text:l.groupInfo.notice,style:{margin:"0","z-index":"1000",position:"absolute"}},null,8,["text"])):$("",!0),M(v,{class:"scroll-view-body",ref:"scrollView","scroll-y":"true","scroll-anchoring":!0,"scroll-top":l.scrollTop,onScroll:c.scrollChat,style:N({height:2===l.is_group?`calc(100% - ${e.CustomBar}px)`:c.scrollH+"rpx",position:"fixed",bottom:(2==l.is_group?0:l.bottomHeight)+"px"})},{default:w((()=>[M(d,{class:T(["cu-chat",[l.morecheck?"more-check-message":""]]),style:N({paddingBottom:l.paddingB+"px"}),onClick:c.closeInput,id:"more-oprate"},{default:w((()=>[1!=l.page?(o(),a(p,{key:0,status:l.loading},null,8,["status"])):$("",!0),M(I,{class:"checkbox-group-container",onChange:c.checkMesssage},{default:w((()=>[(o(!0),B(E,null,U(l.messageList,((t,s)=>(o(),B(E,{key:s},["event"==t.type?(o(),a(d,{key:0,class:"cu-info"},{default:w((()=>[j(S(t.content)+" ",1),1==t.is_undo&&c.getTime()-t.sendTime<1e3*l.globalConfig.chatInfo.redoTime?(o(),a(m,{key:0,class:"c-primary",onClick:e=>c.reEdit(t.oldContent??"")},{default:w((()=>[j("重新编辑")])),_:2},1032,["onClick"])):$("",!0)])),_:2},1024)):"red_log"==t.type?(o(),a(d,{key:1,class:"im-flex im-rows im-nowrap im-justify-content-center c-999"},{default:w((()=>[j(S(t.content),1)])),_:2},1024)):(o(),a(d,{key:2,class:T(["cu-item",[t.fromUser.id==l.user.user_id?"im-rows-reverse self im-justify-content-start":l.morecheck?"more-side-check-message":""]]),onClick:e=>c.setMoreCheck(t)},{default:w((()=>[M(f,{morecheck:l.morecheck,info:t.fromUser,profile:l.isProfile&&Boolean(this.contact.is_private),onLongpress:e=>c.at(t.fromUser)},null,8,["morecheck","info","profile","onLongpress"]),M(d,{class:T(["main im-wrap",[t.fromUser.id==l.user.user_id?"im-rows-reverse":""]]),onTouchstart:e=>c.moreOption(e,t,s),onTouchmove:c.ListTouchMove,onTouchend:c.endTimer,onClick:e=>c.dblclick(t)},{default:w((()=>[M(d,{class:"f-12 c-666",style:{width:"100%","margin-bottom":"6rpx"}},{default:w((()=>[t.fromUser.id!=l.user.user_id?(o(),a(m,{key:0},{default:w((()=>[j(S(t.fromUser.realname)+"   ",1)])),_:2},1024)):$("",!0),M(m,{class:"f-11 c-999"},{default:w((()=>[j(S(e.sendTime(t.sendTime)),1)])),_:2},1024)])),_:2},1024),M(d,{class:"im-flex im-rows-reverse self im-align-items-end"},{default:w((()=>["text"==t.type?(o(),a(d,{key:0},{default:w((()=>[M(d,{class:T(["content shadow",[t.fromUser.id==l.user.user_id?"bg-light-green":""]])},{default:w((()=>[M(_,{"container-style":"overflow: hidden;display:inline;white-space: pre-wrap",content:e.emojiToHtml(t.content)},null,8,["content"])])),_:2},1032,["class"]),t.extends&&t.extends.content?(o(),a(d,{key:0,class:"message-quote radius-6"},{default:w((()=>[j(S(t.extends.content),1)])),_:2},1024)):$("",!0)])),_:2},1024)):"image"==t.type?(o(),B(E,{key:1},[t.extends&&t.extends.fixMode?(o(),B(E,{key:0},[t.extends.fixMode<=2?(o(),a(x,{key:0,src:t.content,class:"radius",mode:1==t.extends.fixMode?"widthFix":"heightFix",style:N(1==t.extends.fixMode?"width:200px":""),onClick:e.showImgs,"data-img":t.content},null,8,["src","mode","style","onClick","data-img"])):$("",!0),3==t.extends.fixMode?(o(),a(x,{key:1,src:t.content,class:"radius",mode:"scaleToFill",style:N([{width:t.extends.width+"px",height:t.extends.height+"px"}]),onClick:e.showImgs,"data-img":t.content},null,8,["src","style","onClick","data-img"])):$("",!0)],64)):(o(),a(x,{key:1,src:t.content,class:"radius",mode:"heightFix",onClick:e.showImgs,"data-img":t.content},null,8,["src","onClick","data-img"]))],64)):"voice"==t.type?(o(),a(d,{key:2,class:"im-flex im-columns"},{default:w((()=>[M(d,{class:T(["im-voice-msg im-flex im-rows im-nowrap im-align-items-center radius-20",[s==l.playIndex?"linear-green":"",t.fromUser.id==l.user.user_id?"im-rows-reverse":""]]),"data-voice":t.content,"data-index":s,onClick:c.playVoice,style:N({width:3*t.extends.duration+"px"})},{default:w((()=>[M(m,{class:T(["f-16 cuIcon-subscription rotate45",[s==l.playIndex?"c-white":"",t.fromUser.id==l.user.user_id?"rotate225":""]])},null,8,["class"]),M(m,{class:T(["im-voice-msg-text",[s==l.playIndex?"c-white":""]])},{default:w((()=>[j(S(t.extends.duration)+' "',1)])),_:2},1032,["class"])])),_:2},1032,["class","data-voice","data-index","onClick","style"]),t.voice_text?(o(),a(d,{key:0,class:"voice_text"},{default:w((()=>[j(S(t.voice_text),1)])),_:2},1024)):$("",!0)])),_:2},1024)):"video"==t.type?(o(),a(d,{key:3},{default:w((()=>[M(d,{class:"course-video radius-10",onClick:s=>e.handlePlay(t)},{default:w((()=>[M(d,{class:"relative-shadow"},{default:w((()=>[M(d,{class:"cuIcon-video icon-center f-28 c-white"})])),_:1}),t.extends?(o(),a(x,{key:0,src:t.extends.poster,class:"",mode:"heightFix"},null,8,["src"])):$("",!0)])),_:2},1032,["onClick"])])),_:2},1024)):"file"==t.type?(o(),a(d,{key:4},{default:w((()=>[M(d,{class:"file-card bg-white radius-10 im-flex im-justify-content-start pd-10 im-align-items-center",onClick:L((s=>e.previewFile(t)),["stop"])},{default:w((()=>[M(x,{src:t.extUrl,style:{width:"64rpx",height:"80rpx"}},null,8,["src"]),M(d,{class:"im-flex im-columns ml-10"},{default:w((()=>[M(d,{class:"text-overflow file-name"},{default:w((()=>[j(S(t.fileName),1)])),_:2},1024),M(d,{class:"text-gray file-size f-12"},{default:w((()=>[j(S(e.fileSize(t.fileSize)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)):"webrtc"==t.type?(o(),a(d,{key:5,onClick:e=>c.calling(t.extends.type),class:T(["im-voice-msg im-flex im-rows im-nowrap im-align-items-center radius-20",[t.fromUser.id==l.user.user_id?"im-rows-reverse":""]])},{default:w((()=>[M(m,{class:T(["f-16",[1==t.extends.type?"cuIcon-record":"cuIcon-dianhua",t.fromUser.id==l.user.user_id?"rotate180":""]])},null,8,["class"]),M(m,{class:"im-voice-msg-text"},{default:w((()=>[j(S(t.content),1)])),_:2},1024)])),_:2},1032,["onClick","class"])):"location"==t.type?(o(),a(d,{key:6,onClick:s=>e.openLocation(t.extends),class:"im-location-msg im-flex im-rows im-nowrap im-align-items-center radius-8 pd-10"},{default:w((()=>[M(d,{class:"f-24 cuIcon-location pr-5"}),M(d,null,{default:w((()=>[M(d,{class:"f-14 mb-5"},{default:w((()=>[j(S(t.content),1)])),_:2},1024),M(d,{class:"c-999 f-12"},{default:w((()=>[j(S(t.extends&&t.extends.address),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])):"contact"==t.type?(o(),a(d,{key:7,onClick:s=>e.openContact(t.extends),class:"im-contact-msg radius-8 pt-10 pr-10 pl-10 pb-5"},{default:w((()=>[M(d,{class:"im-flex im-rows im-nowrap im-align-items-center"},{default:w((()=>[M(d,{class:"cu-avatar mr-10 radius",style:N([{backgroundImage:"url("+t.extends.avatar+")"}])},null,8,["style"]),M(d,{class:"c-333"},{default:w((()=>[j(S(t.extends.displayName),1)])),_:2},1024)])),_:2},1024),oe("hr",{class:"mt-10 c-999"}),M(d,{class:"c-666 f-10"},{default:w((()=>[j(" 个人名片 ")])),_:1})])),_:2},1032,["onClick"])):"red"==t.type?(o(),a(d,{key:8,onClick:e=>c.openRedEnvelope(t,s),class:"bubble im-red-msg radius-8 pt-10 pr-10 pl-10 pb-5"},{default:w((()=>[M(x,{class:T([t.fromUser.id==l.user.user_id?"im-rows-reverse":""]),src:t.extends.user_id==l.user.id?"/static/image/red-envelope.png":"/static/image/red-envelope-o.png","lazy-load":!0,style:N({opacity:t.is_get||t.is_done?.6:1})},null,8,["class","src","style"]),M(d,{class:"tis"},{default:w((()=>[j(S(t.is_get?"已领取":"恭喜发财，大吉大利"),1)])),_:2},1024),M(d,{class:"blessing"},{default:w((()=>[M(d,{class:"info"},{default:w((()=>[j(S(t.extends.blessing),1)])),_:2},1024),M(d,{class:"has-get-red"},{default:w((()=>[j(" 点击打开红包 ")])),_:1})])),_:2},1024)])),_:2},1032,["onClick"])):"transfer"==t.type?(o(),a(d,{key:9,onClick:e=>c.toTransfer(t),class:"bubble im-red-msg radius-8 pt-10 pr-10 pl-10 pb-5"},{default:w((()=>[M(x,{class:T([t.fromUser.id==l.user.user_id?"im-rows-reverse":""]),src:t.extends.user_id==l.user.id?"/static/image/transfer.png":"/static/image/transfer-o.png","lazy-load":!0},null,8,["class","src"]),M(d,{class:"tis"},{default:w((()=>[j(" 转账 ")])),_:1}),M(d,{class:"blessing"},{default:w((()=>[M(d,{class:"info"},{default:w((()=>[j(" ¥"+S(t.extends.amount),1)])),_:2},1024),M(d,{class:"has-get-red"},{default:w((()=>[j(S(t.fromUser.id==l.user.user_id?"你发起了一笔转账":"你收到了一笔转账"),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])):"emoji"==t.type?(o(),a(x,{key:10,src:t.content,class:"radius",mode:"aspectFit",onClick:e.showImgs,"data-img":t.content,style:{width:"300rpx",height:"300rpx"}},null,8,["src","onClick","data-img"])):(o(),a(y,{key:11,item:t,index:s,isSelf:!0},null,8,["item","index"])),t.fromUser.id==l.user.user_id?(o(),a(d,{key:12,class:"mt-10 mr-5 f-20"},{default:w((()=>["going"==t.status?(o(),a(d,{key:0,class:"cuIcon-icloading icon-spin c-999"})):$("",!0),"failed"==t.status?(o(),a(d,{key:1,class:"cuIcon-infofill c-red",onClick:e=>c.reSend(t)},null,8,["onClick"])):$("",!0),0==t.is_group?(o(),a(d,{key:2,class:T(["f-16",t.is_read?"text-green cuIcon-roundcheckfill":"c-999 cuIcon-roundcheck"])},null,8,["class"])):$("",!0)])),_:2},1024)):$("",!0)])),_:2},1024)])),_:2},1032,["class","onTouchstart","onTouchmove","onTouchend","onClick"]),l.notForward.indexOf(t.type)<0?(o(),a(k,{key:0,class:T(["round",-1!=l.selectMessage.indexOf(t.msg_id)?"checked":""]),checked:-1!=l.selectMessage.indexOf(t.msg_id),value:t.msg_id?t.msg_id.toString():t.msg_id},null,8,["class","checked","value"])):$("",!0)])),_:2},1032,["onClick","class"]))],64)))),128))])),_:1},8,["onChange"])])),_:1},8,["style","onClick","class"])])),_:1},8,["scroll-top","onScroll","style"]),l.is_group<2?(o(),a(d,{key:1,id:"im-input"},{default:w((()=>[M(R,{morecheck:l.morecheck,onCloseTool:c.closeInput,onSend:c.sendMessage,onSetPad:c.setPad,boxStatus:l.boxStatus,contact:l.contact,ref:"imInput"},null,8,["morecheck","onCloseTool","onSend","onSetPad","boxStatus","contact"])])),_:1})):$("",!0),M(O,{onForward:c.forwardMessage,class:T([l.morecheck?"show-operate":""])},null,8,["onForward","class"]),M(d,{class:T(["cu-modal bottom-modal","moreOpt"==l.modelName?"show":""]),onClick:t[10]||(t[10]=e=>l.modelName="")},{default:w((()=>[l.curMsg?(o(),a(d,{key:0,class:"cu-dialog"},{default:w((()=>[M(d,{class:"cu-list menu bg-white"},{default:w((()=>["video"===l.curMsg.type?(o(),a(d,{key:0,class:"cu-item",onClick:t[0]||(t[0]=e=>c.download(l.curMsg))},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,{class:"cuIcon-copy"}),M(m,null,{default:w((()=>[j("保存视频")])),_:1})])),_:1})])),_:1})):$("",!0),M(d,{class:"cu-item",onClick:t[1]||(t[1]=e=>c.copyMsg())},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,{class:"cuIcon-copy"}),M(m,null,{default:w((()=>[j("复制"+S(l.copyTxt),1)])),_:1})])),_:1})])),_:1}),"emoji"==l.curMsg.type?(o(),a(d,{key:1,class:"cu-item",onClick:t[2]||(t[2]=e=>c.colEmoji())},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,{class:"cuIcon-emoji"}),M(m,null,{default:w((()=>[j("保存到我的表情")])),_:1})])),_:1})])),_:1})):$("",!0),l.notForward.indexOf(l.curMsg.type)<0?(o(),a(d,{key:2,class:"cu-item",onClick:t[3]||(t[3]=e=>c.forwardMsg())},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,{class:"cuIcon-forward"}),M(m,null,{default:w((()=>[j("转发")])),_:1})])),_:1})])),_:1})):$("",!0),"voice"==l.curMsg.type?(o(),a(d,{key:3,class:"cu-item",onClick:t[4]||(t[4]=e=>c.translateVoice())},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,{class:"cuIcon-forward"}),M(m,null,{default:w((()=>[j("转文字")])),_:1})])),_:1})])),_:1})):$("",!0),M(d,{class:"cu-item",onClick:t[5]||(t[5]=e=>c.moreCheckHandle())},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(x,{src:"/static/image/morecheck.png",style:{width:"35rpx",height:"35rpx","margin-right":"20rpx"}}),M(m,null,{default:w((()=>[j("多选")])),_:1})])),_:1})])),_:1}),M(d,{class:"parting-line-5"}),M(d,{class:"cu-item",onClick:t[6]||(t[6]=e=>c.quoteMsg())},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,{class:"cuIcon-tag"}),M(m,null,{default:w((()=>[j("引用")])),_:1})])),_:1})])),_:1}),l.curMsg.fromUser.id==l.user.user_id?(o(),a(d,{key:4,class:"cu-item",onClick:t[7]||(t[7]=e=>c.editMsg())},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,{class:"cuIcon-copy"}),M(m,null,{default:w((()=>[j("编辑")])),_:1})])),_:1})])),_:1})):$("",!0),l.globalConfig.chatInfo.dbDelMsg&&l.curMsg.fromUser.id==l.user.user_id||1==l.is_group&&l.groupInfo.owner_id===l.user.user_id?(o(),a(d,{key:5,class:"cu-item",onClick:t[8]||(t[8]=e=>c.delMsg())},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,{class:"cuIcon-delete c-red"}),M(m,{class:"c-red"},{default:w((()=>[j("删除")])),_:1})])),_:1})])),_:1})):$("",!0),M(d,{class:"parting-line-5"}),M(d,{class:"cu-item",onClick:t[9]||(t[9]=e=>l.modelName="")},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,{class:"c-orange"},{default:w((()=>[j("取消")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):$("",!0)])),_:1},8,["class"]),M(d,{class:T(["cu-modal bottom-modal","copyModel"==l.modelName?"show":""])},{default:w((()=>[M(d,{class:"cu-dialog"},{default:w((()=>[M(d,{class:"cu-bar bg-white"},{default:w((()=>[M(d,{class:"action text-gray",onClick:t[11]||(t[11]=e=>l.modelName="")},{default:w((()=>[j("取消")])),_:1}),M(d,{class:"action text-green",onClick:t[12]||(t[12]=e=>c.copyMsg())},{default:w((()=>[j("复制")])),_:1})])),_:1}),M(v,{"scroll-y":"true",style:N({height:c.scrollH+"rpx"})},{default:w((()=>[M(d,{class:"pd-20 text-container"},{default:w((()=>[M(_,{content:l.curMsg.content},null,8,["content"])])),_:1})])),_:1},8,["style"])])),_:1})])),_:1},8,["class"]),l.atCount?(o(),a(d,{key:2,class:"at-fixed-item",onClick:c.openAtModel,style:N({bottom:130+e.inlineTools+"rpx"})},{default:w((()=>[j(" 有"+S(l.atCount)+"人提到我 ",1)])),_:1},8,["onClick","style"])):l.isBottom?$("",!0):(o(),a(d,{key:3,class:"at-fixed-item",onClick:t[13]||(t[13]=e=>c.scrollToBottom()),style:N({bottom:130+e.inlineTools+"rpx"})},{default:w((()=>[j(" 回到底部 ")])),_:1},8,["style"])),M(d,{class:T(["cu-modal bottom-modal","atModel"==l.modelName?"show":""]),onClick:t[15]||(t[15]=e=>l.modelName="")},{default:w((()=>["atModel"==l.modelName?(o(),a(d,{key:0,class:"cu-dialog"},{default:w((()=>[M(d,{class:"cu-bar bg-white"},{default:w((()=>[M(d,{class:"action"},{default:w((()=>[j("提到我的人")])),_:1}),M(d,{class:"action text-green"},{default:w((()=>[j("已读")])),_:1})])),_:1}),M(v,{"scroll-y":"true",style:N({height:c.scrollH+"rpx"}),onClick:t[14]||(t[14]=L((()=>{}),["stop"]))},{default:w((()=>[M(d,{class:"cu-chat",style:{"text-align":"left"}},{default:w((()=>[(o(!0),B(E,null,U(l.atMsgList,((t,s)=>(o(),a(d,{class:"cu-item",key:s,style:{"padding-bottom":"10rpx"}},{default:w((()=>[M(f,{morecheck:l.morecheck,info:t.fromUser,profile:l.isProfile&&Boolean(this.contact.is_private),onLongpress:e=>c.at(t.fromUser)},null,8,["morecheck","info","profile","onLongpress"]),M(d,{class:"main im-wrap",onClick:e=>c.dblclick(t)},{default:w((()=>[M(d,{class:"f-12 c-666",style:{width:"100%","margin-bottom":"6rpx"}},{default:w((()=>[j(S(t.fromUser.realname),1),M(m,{class:"text-gray"},{default:w((()=>[j("    "+S(e.$util.date("Y-m-d H:i:s",t.sendTime)),1)])),_:2},1024)])),_:2},1024),"text"==t.type?(o(),a(d,{key:0,class:"content shadow"},{default:w((()=>[M(_,{"container-style":"overflow: hidden;display:inline;white-space: pre-wrap",content:e.emojiToHtml(t.content)},null,8,["content"])])),_:2},1024)):$("",!0),t.extends&&t.extends.content?(o(),a(d,{key:1,class:"message-quote radius-6 align-left"},{default:w((()=>[j(S(t.extends.content),1)])),_:2},1024)):$("",!0)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["style"])])),_:1})):$("",!0)])),_:1},8,["class"]),M(d,{class:T(["cu-modal bottom-modal","preview"==l.modelName?"show":""]),onClick:t[18]||(t[18]=e=>l.modelName="")},{default:w((()=>["preview"==l.modelName?(o(),a(d,{key:0,class:"cu-dialog"},{default:w((()=>[M(d,{class:"cu-list menu bg-white"},{default:w((()=>[M(d,{class:"cu-item",onClick:t[16]||(t[16]=t=>e.preview(1))},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,{class:"text-center"},{default:w((()=>[j("本地预览(需下载)")])),_:1}),M(d,{class:"text-gray text-sm"},{default:w((()=>[j("需下载，仅支持office类型文件")])),_:1})])),_:1})])),_:1}),M(d,{class:"cu-item",onClick:t[17]||(t[17]=t=>e.preview(2))},{default:w((()=>[M(d,{class:"content padding-tb-sm"},{default:w((()=>[M(m,null,{default:w((()=>[j("在线预览")])),_:1}),M(d,{class:"text-gray text-sm"},{default:w((()=>[j("支持常用的文件和文档")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):$("",!0)])),_:1},8,["class"]),M(d,{class:T(["windows",l.windowsState])},{default:w((()=>[M(d,{class:"mask",onTouchmove:L(c.discard,["stop","prevent"]),onClick:c.closeRedEnvelope},null,8,["onTouchmove","onClick"]),M(d,{class:"layer",onTouchmove:L(c.discard,["stop","prevent"])},{default:w((()=>[M(d,{class:"open-redenvelope"},{default:w((()=>[M(d,{class:"top"},{default:w((()=>[M(d,{class:"close-btn"},{default:w((()=>[M(d,{class:"icon close",onClick:c.closeRedEnvelope},null,8,["onClick"])])),_:1})])),_:1}),M(d,{class:"blessing"},{default:w((()=>[j(S(l.redenvelopeData.blessing),1)])),_:1}),M(d,{class:"money",onClick:t[19]||(t[19]=e=>c.openRed(l.redenvelopeData))},{default:w((()=>[M(x,{class:T(l.luckbtn),src:"/assets/red_2-lCYVXsjL.png",style:{width:"180upx",height:"180upx"}},null,8,["class"])])),_:1}),M(d,{class:"showDetails",onClick:t[20]||(t[20]=e=>c.toDetails(l.redenvelopeData.msg_id))},{default:w((()=>[j(" 查看领取详情 "),M(d,{class:"icon to"})])),_:1})])),_:1})])),_:1},8,["onTouchmove"])])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-c1f33cf8"]]);export{Ne as default};
