import{_ as a,q as e,s,x as t,G as l,n as o,A as n,a5 as i,B as u,C as r,c as d,w as f,g as c,o as g,a as m,e as p,t as h,m as I,b as x,d as _,F as v,f as y,j as b,ab as S,af as C,ae as A,at as N,W as V,ag as k,ay as J}from"./index-BWCeDMGH.js";import{a as O}from"./yq-avatar.BZAck8mQ.js";const U=e(s);const $=a({components:{avatar:O},data:()=>({loginStore:U,globalConfig:U.globalConfig,userInfo:{},sexList:[{id:"2",name:"未知"},{id:"1",name:"男"},{id:"0",name:"女"}],saved:!1}),mounted(){this.userInfo=JSON.parse(JSON.stringify(U.userInfo))},methods:{logout(){let a=t("client_id");this.$api.LoginApi.logout({client_id:a}).then((a=>{0==a.code&&U.logout()}))},textareaBInput(a){this.userInfo.motto=a.detail.value},changeSex(a){this.userInfo.sex=parseInt(a.detail.value)},saveInfo(){if(""==this.userInfo.realname)return l({title:"请输入昵称",icon:"none"}),!1;if(this.userInfo.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.userInfo.email))return l({title:"请输入正确的邮箱",icon:"none"}),!1;this.saved=!0;let a={realname:this.userInfo.realname,email:this.userInfo.email,sex:this.userInfo.sex,motto:this.userInfo.motto};this.$api.msgApi.updateUserInfo(a).then((a=>{if(0==a.code){l({title:"保存成功",icon:"none"});let a=JSON.parse(JSON.stringify(this.userInfo));U.login(a)}})),setTimeout((()=>{this.saved=!1}),8e3)},setAvatar(){o({url:"/pages/mine/avatar"})},uploadAvatar(a){n({title:"上传中..."}),i({url:this.$api.msgApi.uploadAvatar,filePath:a.path,name:"file",header:{Authorization:t("authToken")},formData:{ext:"png"},success:a=>{u();let e=JSON.parse(a.data);if(0==e.code){l({title:e.msg,icon:"none"}),this.userInfo.avatar=e.data;let a=JSON.parse(JSON.stringify(this.userInfo));U.login(a)}},fail:a=>{u()}})}}},[["render",function(a,e,s,t,l,o){const n=r("cu-custom"),i=c,u=r("avatar"),O=b,U=S,$=k,j=J,q=C,B=A,L=N,M=V;return g(),d(i,null,{default:f((()=>[m(n,{bgColor:"bg-gradual-green",isBack:!0},{backText:f((()=>[])),content:f((()=>[p("个人信息")])),_:1}),m(L,null,{default:f((()=>[m(i,{class:"cu-form-group",style:{height:"140rpx"}},{default:f((()=>[m(i,{class:"title"},{default:f((()=>[p("头像")])),_:1}),m(i,{class:"im-flex im-align-items-center"},{default:f((()=>[m(u,{selWidth:"240px",selHeight:"480upx",expWidth:"240px",expHeight:"240px",onUpload:o.uploadAvatar,avatarSrc:l.userInfo.avatar,avatarStyle:"width: 100rpx; height: 100rpx; border-radius: 100%;",quality:1},null,8,["onUpload","avatarSrc"]),m(O,{class:"cuIcon-right ml-10 f-18 text-grey"})])),_:1})])),_:1}),m(i,{class:"cu-form-group"},{default:f((()=>[m(i,{class:"title"},{default:f((()=>[p("账号")])),_:1}),m(i,{class:"text-gray"},{default:f((()=>[p(h(l.userInfo.account),1)])),_:1})])),_:1}),m(i,{class:"cu-form-group"},{default:f((()=>[m(i,{class:"title"},{default:f((()=>[p(h(1==l.globalConfig.sysInfo.runMode?"姓名":"昵称"),1)])),_:1}),1==l.globalConfig.sysInfo.runMode&&1!=l.globalConfig.sysInfo.diyName?(g(),d(i,{key:0,class:"text-gray"},{default:f((()=>[p(h(l.userInfo.realname),1)])),_:1})):I("",!0),2==l.globalConfig.sysInfo.runMode||1==l.globalConfig.sysInfo.diyName?(g(),d(U,{key:1,class:"uni-input",style:{"text-align":"right"},modelValue:l.userInfo.realname,"onUpdate:modelValue":e[0]||(e[0]=a=>l.userInfo.realname=a),placeholder:"请输入昵称"},null,8,["modelValue"])):I("",!0)])),_:1}),m(i,{class:"cu-form-group"},{default:f((()=>[m(i,{class:"title"},{default:f((()=>[p("e-mail")])),_:1}),m(U,{class:"uni-input",style:{"text-align":"right"},modelValue:l.userInfo.email,"onUpdate:modelValue":e[1]||(e[1]=a=>l.userInfo.email=a),placeholder:"请输入email地址"},null,8,["modelValue"])])),_:1}),m(i,{class:"cu-form-group"},{default:f((()=>[m(i,{class:"title"},{default:f((()=>[p("性别")])),_:1}),m(i,null,{default:f((()=>[m(q,{onChange:o.changeSex},{default:f((()=>[(g(!0),x(v,null,_(l.sexList,(a=>(g(),d(j,{class:"radio mr-10"},{default:f((()=>[m($,{name:"sex",value:a.id,checked:l.userInfo.sex==a.id},null,8,["value","checked"]),p(" "+h(a.name),1)])),_:2},1024)))),256))])),_:1},8,["onChange"])])),_:1})])),_:1}),m(i,{class:"cu-form-group align-start"},{default:f((()=>[m(i,{class:"title"},{default:f((()=>[p("个性签名")])),_:1}),m(B,{maxlength:"-1",modelValue:l.userInfo.motto,"onUpdate:modelValue":e[2]||(e[2]=a=>l.userInfo.motto=a),placeholder:"请输入个性签名"},null,8,["modelValue"])])),_:1})])),_:1}),m(i,{class:"padding flex flex-direction"},{default:f((()=>[m(M,{class:"cu-btn bg-green lg",style:y(l.saved?"border: solid 1px #dbdada;":""),disabled:l.saved,onClick:e[3]||(e[3]=a=>o.saveInfo())},{default:f((()=>[p("保存")])),_:1},8,["style","disabled"])])),_:1})])),_:1})}]]);export{$ as default};
