import{_ as t,G as a,o as e,c as n,w as s,a as l,a7 as i,e as d,t as r,b as h,m as o,K as y,L as g,d as c,F as u,f,g as p,aR as m,W as D,l as _,q as k,s as w,A as b,B as A,C as S}from"./index-CDOpH1f_.js";const v=t({props:{lang:{type:String,default:"zh"},type:{type:String,default:"calendar"},checkDate:{type:Boolean,default:!1},bgweek:{type:String,default:"#FF8F22"},bgday:{type:String,default:"#FF8F22"},signin_but_bg:{type:String,default:"#909399"},supplementary:{type:Boolean,default:!0},already:{type:Array,default:[]},checkinDays:{type:[Number,String],default:0},integral:{type:[Number,String],default:0},isIntegral:{type:Boolean,default:!1}},watch:{already:{handler(t){this.getAlready()},immediate:!0,deep:!0}},data:()=>({weeked:"",dayArr:[],localDate:"",day:(new Date).getDate(),year:(new Date).getFullYear(),month:(new Date).getMonth()+1,weekArr:["日","一","二","三","四","五","六"],aheadDay:0,thisMonth:(new Date).getMonth()+1,prv:!0,next:!0,is_day_signin:!1}),mounted(){let t=this;if(t.initDate(),t.localDate=t.year+"-"+t.formatNum(t.month)+"-"+t.formatNum(t.day),"zh"!=t.lang&&(t.weekArr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]),t.weeked=t.weekArr[(new Date).getDay()],"calendar"!=t.type)for(let a in t.dayArr)t.$set(t.dayArr[a],"flag",!1)},methods:{getAlready(){for(let t in this.dayArr)-1==this.already.indexOf(new Date(this.dayArr[t].date).getTime())?this.$set(this.dayArr[t],"flag",!1):(this.$set(this.dayArr[t],"flag",!0),this.dayArr[t].date==this.localDate&&(this.is_day_signin=!0))},shift(){this.$emit("shift")},changeDate(t){let a=this;a.year=parseInt(t.detail.value.split("-")[0]),a.month=parseInt(t.detail.value.split("-")[1]),a.initDate()},daySign(t){let e=this.aheadDay+this.day-1;if(this.dayArr[e].flag)return!1;this.$set(this.dayArr[e],"flag",!0),this.$emit("change",t.date),this.is_day_signin=!0,a({title:"已签到",icon:"success"})},signToday(t,e){let n=this;if("calendar"!=n.type&&(new Date).getMonth()+1==parseInt(t.date.split("-")[1])&&""!=t.date&&t.day<n.day)if(n.dayArr[e].flag)a({title:"已签到",icon:"none"});else{if(n.day>t.day&&!n.supplementary)return;console.log(t.day),a({title:n.day>t.day?"补签成功":"签到成功",icon:"success"}),n.$set(n.dayArr[e],"flag",!0),n.$emit("change",t.date)}},initDate(){let t=this;t.dayArr=[];let a=new Date(t.year,t.month,0).getDate();for(let e=1;e<=a;e++){let n=new Date(t.year,t.month-1,e).getDay();1==e&&0!=n&&(t.addBefore(n),t.aheadDay=n);let s={};s.date=t.year+"-"+t.formatNum(t.month)+"-"+t.formatNum(e),s.day=e,t.dayArr.push(s),e==a&&6!=n&&t.addAfter(n)}this.getAlready()},addBefore(t){let a=this,e=new Date(a.year,a.month-1,0).getDate();for(let n=0;n<t;n++){let s={date:""};s.day=e-(t-n)+1,a.dayArr.push(s)}},addAfter(t){let a=this;for(let e=0;e<6-t;e++){let t={date:""};t.day=e+1,a.dayArr.push(t)}},formatNum:t=>t<10?"0"+t:t,lastMonth(){let t=this;1==t.month?(t.year-=1,t.month=12):t.month-=1,t.initDate(),this.year>=(new Date).getFullYear()||this.month>(new Date).getMonth()+2?this.prv=!0:this.prv=!1,this.year<=(new Date).getFullYear()||this.month<(new Date).getMonth()?this.next=!0:this.next=!1},nextMonth(){let t=this;12==t.month?(t.year+=1,t.month=1):t.month+=1,t.initDate(),this.year>=(new Date).getFullYear()||this.month>(new Date).getMonth()+2?this.prv=!0:this.prv=!1,this.year<=(new Date).getFullYear()||this.month<(new Date).getMonth()?this.next=!0:this.next=!1}}},[["render",function(t,a,k,w,b,A){const S=p,v=m,x=D;return e(),n(S,{class:"calendar-box"},{default:s((()=>[l(S,{class:"top"},{default:s((()=>[l(S,null,{default:s((()=>[i("h4",null,[d("已连续签到 "),i("span",null,r(k.checkinDays),1),d(" 天")]),k.isIntegral?(e(),h("p",{key:0},"签到获得"+r(k.integral)+"元",1)):o("",!0)])),_:1}),l(S,{class:"rig"},{default:s((()=>[k.supplementary?(e(),h("span",{key:0,onClick:a[0]||(a[0]=(...t)=>A.shift&&A.shift(...t))},"补签")):o("",!0)])),_:1})])),_:1}),l(S,{class:"miss_box"},{default:s((()=>[l(S,{class:"month"},{default:s((()=>[l(S,{class:"prv",onClick:A.lastMonth},{default:s((()=>[y(i("span",null,"上月",512),[[g,b.prv]])])),_:1},8,["onClick"]),l(S,null,{default:s((()=>[d(r(b.year)+"年"+r(b.month)+"月",1)])),_:1}),l(S,{class:"prv",onClick:A.nextMonth},{default:s((()=>[y(i("span",null,"下月",512),[[g,b.next]])])),_:1},8,["onClick"]),k.checkDate?(e(),n(v,{key:0,class:"picker",mode:"date",fields:"month",onChange:A.changeDate},null,8,["onChange"])):o("",!0)])),_:1}),l(S,{class:"week"},{default:s((()=>[(e(!0),h(u,null,c(b.weekArr,(t=>(e(),n(S,{style:f("color:"+(t==b.weeked?k.bgweek:"")+";")},{default:s((()=>[d(r(t),1)])),_:2},1032,["style"])))),256))])),_:1}),l(S,{class:"day"},{default:s((()=>[(e(!0),h(u,null,c(b.dayArr,((t,a)=>(e(),n(S,{class:_([{checkday:""==t.date},{choose:t.date==b.localDate||t.flag}]),style:f("background:"+(t.date==b.localDate||t.flag?k.bgday:"")+";"),key:a,onClick:e=>A.signToday(t,a)},{default:s((()=>[d(r(t.day)+" ",1),l(S,{class:_([{circle:t.flag},{repair:t.day<b.day},{sign:t.day==b.day}])},null,8,["class"])])),_:2},1032,["class","style","onClick"])))),128))])),_:1})])),_:1}),l(S,{class:"but"},{default:s((()=>[l(x,{disabled:b.thisMonth!=b.month,style:f("background: "+(b.is_day_signin?k.signin_but_bg:b.thisMonth==b.month?k.bgday:k.signin_but_bg)+";"),onClick:a[1]||(a[1]=t=>A.daySign(b.dayArr[b.aheadDay+b.day-1]))},{default:s((()=>[d(r(b.is_day_signin?"今日已签到":"签到"),1)])),_:1},8,["disabled","style"])])),_:1})])),_:1})}],["__scopeId","data-v-7d34c871"]]),x=k(w);const C=t({components:{youlanSignIn:v},data:()=>({loginStore:x,data:[],checkinDays:0,integral:1}),onShow(){this.loadData()},methods:{loadData(){this.$api.activityApi.loadSignData().then((t=>{if(0==t.code){let a=t.data;this.data=a.signed.map((t=>new Date(t).getTime())),this.integral=1==this.loginStore.userInfo.in_plan?a.points2:a.points,this.checkinDays=a.streak}}))},signDate(t){b({mask:!0}),this.$api.activityApi.sign().then((t=>{0!=t.code&&a({title:t.msg,icon:"none"}),this.loadData(),A()}))}}},[["render",function(t,a,n,o,y,g){const c=S("cu-custom"),m=S("youlanSignIn"),D=p;return e(),h(u,null,[l(c,{bgColor:"bg-video",isBack:!0},{backText:s((()=>[])),content:s((()=>[d("签到")])),right:s((()=>[])),_:1}),l(D,{class:"container",style:f({height:`calc(100% - ${t.CustomBar}px)`})},{default:s((()=>[l(D,{class:"sign-wrapper"},{default:s((()=>[l(m,{integral:y.integral,isIntegral:!0,checkinDays:y.checkinDays,already:y.data,supplementary:!1,type:"sign",lang:"zh",bgweek:"#0081ff",bgday:"#0081ff",signin_but_bg:"#bababa",onChange:g.signDate},null,8,["integral","checkinDays","already","onChange"])])),_:1}),l(D,{class:"desc"},{default:s((()=>[l(D,{class:"title"},{default:s((()=>[d(" 签到说明： ")])),_:1}),l(D,{class:"content"},{default:s((()=>[d(" 每日签到送"+r(y.integral)+"元。",1),i("br")])),_:1})])),_:1})])),_:1},8,["style"])],64)}],["__scopeId","data-v-c71443a0"]]);export{C as default};
