import{_ as e,o as t,c as s,w as i,aa as a,l,f as o,e as n,t as r,m as u,j as d,g as c,n as p,a1 as h,Z as m,ah as f,r as g,a as _,i as y,ad as k,u as b,s as S,q as x,z as w,G as C,C as T,b as v,d as I,F as $,ab as N,W as A}from"./index-CDOpH1f_.js";import{_ as B}from"./uni-icons.QhmNVcfb.js";import{r as U}from"./uni-app.es.DwBKReRU.js";import{_ as L}from"./uni-number-box.DLmAeCrZ.js";import{_ as j}from"./uni-popup.CzDYXpcs.js";const D=e({name:"UniBadge",emits:["click"],props:{type:{type:String,default:"error"},inverted:{type:Boolean,default:!1},isDot:{type:Boolean,default:!1},maxNum:{type:Number,default:99},absolute:{type:String,default:""},offset:{type:Array,default:()=>[0,0]},text:{type:[String,Number],default:""},size:{type:String,default:"small"},customStyle:{type:Object,default:()=>({})}},data:()=>({}),computed:{width(){return 8*String(this.text).length+12},classNames(){const{inverted:e,type:t,size:s,absolute:i}=this;return[e?"uni-badge--"+t+"-inverted":"","uni-badge--"+t,"uni-badge--"+s,i?"uni-badge--absolute":""].join(" ")},positionStyle(){if(!this.absolute)return{};let e=this.width/2,t=10;this.isDot&&(e=5,t=5);const s=`${-e+this.offset[0]}px`,i=`${-t+this.offset[1]}px`,a={rightTop:{right:s,top:i},rightBottom:{right:s,bottom:i},leftBottom:{left:s,bottom:i},leftTop:{left:s,top:i}},l=a[this.absolute];return l||a.rightTop},badgeWidth(){return{width:`${this.width}px`}},dotStyle(){return this.isDot?{width:"10px",height:"10px",borderRadius:"10px"}:{}},displayValue(){const{isDot:e,text:t,maxNum:s}=this;return e?"":Number(t)>s?`${s}+`:t}},methods:{onClick(){this.$emit("click")}}},[["render",function(e,p,h,m,f,g){const _=d,y=c;return t(),s(y,{class:"uni-badge--x"},{default:i((()=>[a(e.$slots,"default",{},void 0,!0),h.text?(t(),s(_,{key:0,class:l([g.classNames,"uni-badge"]),style:o([g.badgeWidth,g.positionStyle,h.customStyle,g.dotStyle]),onClick:p[0]||(p[0]=e=>g.onClick())},{default:i((()=>[n(r(g.displayValue),1)])),_:1},8,["class","style"])):u("",!0)])),_:3})}],["__scopeId","data-v-1fab354a"]]);const O=e({name:"UniListItem",emits:["click","switchChange"],props:{direction:{type:String,default:"row"},title:{type:String,default:""},note:{type:String,default:""},ellipsis:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},clickable:{type:Boolean,default:!1},showArrow:{type:[Boolean,String],default:!1},link:{type:[Boolean,String],default:!1},to:{type:String,default:""},showBadge:{type:[Boolean,String],default:!1},showSwitch:{type:[Boolean,String],default:!1},switchChecked:{type:[Boolean,String],default:!1},badgeText:{type:String,default:""},badgeType:{type:String,default:"success"},badgeStyle:{type:Object,default:()=>({})},rightText:{type:String,default:""},thumb:{type:String,default:""},thumbSize:{type:String,default:"base"},showExtraIcon:{type:[Boolean,String],default:!1},extraIcon:{type:Object,default:()=>({type:"",color:"#000000",size:20})},border:{type:Boolean,default:!0}},data:()=>({isFirstChild:!1}),mounted(){this.list=this.getForm(),this.list&&(this.list.firstChildAppend||(this.list.firstChildAppend=!0,this.isFirstChild=!0))},methods:{getForm(e="uniList"){let t=this.$parent,s=t.$options.name;for(;s!==e;){if(t=t.$parent,!t)return!1;s=t.$options.name}return t},onClick(){""===this.to?(this.clickable||this.link)&&this.$emit("click",{data:{}}):this.openPage()},onSwitchChange(e){this.$emit("switchChange",e.detail)},openPage(){-1!==["navigateTo","redirectTo","reLaunch","switchTab"].indexOf(this.link)?this.pageApi(this.link):this.pageApi("navigateTo")},pageApi(e){let t={url:this.to,success:e=>{this.$emit("click",{data:e})},fail:e=>{this.$emit("click",{data:e})}};switch(e){case"navigateTo":default:p(t);break;case"redirectTo":f(t);break;case"reLaunch":m(t);break;case"switchTab":h(t)}}}},[["render",function(e,o,p,h,m,f){const b=c,S=y,x=U(g("uni-icons"),B),w=d,C=U(g("uni-badge"),D),T=k;return t(),s(b,{class:l([{"uni-list-item--disabled":p.disabled},"uni-list-item"]),"hover-class":!p.clickable&&!p.link||p.disabled||p.showSwitch?"":"uni-list-item--hover",onClick:f.onClick},{default:i((()=>[m.isFirstChild?u("",!0):(t(),s(b,{key:0,class:l(["border--left",{"uni-list--border":p.border}])},null,8,["class"])),_(b,{class:l(["uni-list-item__container",{"container--right":p.showArrow||p.link,"flex--direction":"column"===p.direction}])},{default:i((()=>[a(e.$slots,"header",{},(()=>[_(b,{class:"uni-list-item__header"},{default:i((()=>[p.thumb?(t(),s(b,{key:0,class:"uni-list-item__icon"},{default:i((()=>[_(S,{src:p.thumb,class:l(["uni-list-item__icon-img",["uni-list--"+p.thumbSize]])},null,8,["src","class"])])),_:1})):p.showExtraIcon?(t(),s(b,{key:1,class:"uni-list-item__icon"},{default:i((()=>[_(x,{color:p.extraIcon.color,size:p.extraIcon.size,type:p.extraIcon.type},null,8,["color","size","type"])])),_:1})):u("",!0)])),_:1})]),!0),a(e.$slots,"body",{},(()=>[_(b,{class:l(["uni-list-item__content",{"uni-list-item__content--center":p.thumb||p.showExtraIcon||p.showBadge||p.showSwitch}])},{default:i((()=>[p.title?(t(),s(w,{key:0,class:l(["uni-list-item__content-title",[0!==p.ellipsis&&p.ellipsis<=2?"uni-ellipsis-"+p.ellipsis:""]])},{default:i((()=>[n(r(p.title),1)])),_:1},8,["class"])):u("",!0),p.note?(t(),s(w,{key:1,class:"uni-list-item__content-note"},{default:i((()=>[n(r(p.note),1)])),_:1})):u("",!0)])),_:1},8,["class"])]),!0),a(e.$slots,"footer",{},(()=>[p.rightText||p.showBadge||p.showSwitch?(t(),s(b,{key:0,class:l(["uni-list-item__extra",{"flex--justify":"column"===p.direction}])},{default:i((()=>[p.rightText?(t(),s(w,{key:0,class:"uni-list-item__extra-text"},{default:i((()=>[n(r(p.rightText),1)])),_:1})):u("",!0),p.showBadge?(t(),s(C,{key:1,type:p.badgeType,text:p.badgeText,"custom-style":p.badgeStyle},null,8,["type","text","custom-style"])):u("",!0),p.showSwitch?(t(),s(T,{key:2,disabled:p.disabled,checked:p.switchChecked,onChange:f.onSwitchChange},null,8,["disabled","checked","onChange"])):u("",!0)])),_:1},8,["class"])):u("",!0)]),!0)])),_:3},8,["class"]),p.showArrow||p.link?(t(),s(x,{key:1,size:16,class:"uni-icon-wrapper",color:"#bbb",type:"arrowright"})):u("",!0)])),_:3},8,["class","hover-class","onClick"])}],["__scopeId","data-v-75a881cf"]]);const z=e({name:"uniList","mp-weixin":{options:{multipleSlots:!1}},props:{enableBackToTop:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},border:{type:Boolean,default:!0}},created(){this.firstChildAppend=!1},methods:{loadMore(e){this.$emit("scrolltolower")}}},[["render",function(e,l,o,n,r,d){const p=c;return t(),s(p,{class:"uni-list uni-border-top-bottom"},{default:i((()=>[o.border?(t(),s(p,{key:0,class:"uni-list--border-top"})):u("",!0),a(e.$slots,"default",{},void 0,!0),o.border?(t(),s(p,{key:1,class:"uni-list--border-bottom"})):u("",!0)])),_:3})}],["__scopeId","data-v-a351b006"]]),E=b(S),M=x(S);const F=e({data:()=>({keywords:"",group_id:"",modelName:"",userList:[],allUser:[],isAdmin:!1,isManage:!1,isAuth:!1,noSpeakTimer:0,noSpeakDay:1,userInfo:M.userInfo,curUser:{},noSpeakList:[{name:"10分钟",id:1},{name:"1小时",id:2},{name:"3小时",id:3},{name:"1天",id:4}]}),watch:{keywords(e){""==e?this.userList=this.allUser:this.search()}},onLoad(e){this.group_id=e.group_id?e.group_id:"",this.getGroupuserlist()},methods:{getGroupuserlist(){this.userList=[],this.$api.msgApi.groupUserList({group_id:this.group_id}).then((e=>{const t=e.data.filter((e=>1==e.role&&e.userInfo.id==this.userInfo.user_id));t.length&&(this.isAdmin=!0);const s=e.data.filter((e=>2==e.role&&e.userInfo.id==this.userInfo.user_id));s.length&&(this.manage=!0),(t.length||s.length)&&(this.isAuth=!0);const i=e.data;i.forEach((e=>{e.realname=e.userInfo.displayName,e.name_py=e.userInfo.name_py})),this.allUser=i,this.userList=e.data}))},openModel(e){e.realname=e.userInfo.displayName,e.avatar=e.userInfo.avatar,this.curUser=e,this.modelName="userOpt"},setManage(){const e=2==this.curUser.role?3:2;this.$api.msgApi.setManager({id:this.group_id,user_id:this.curUser.user_id,role:e}).then((e=>{0==e.code&&this.getGroupuserlist(),this.modelName=""}))},removeUser(){this.modelName="",w({title:"确定要删除该成员吗?",success:e=>{e.confirm&&this.$api.msgApi.removeUser({id:this.group_id,user_id:this.curUser.user_id}).then((e=>{0==e.code&&this.getGroupuserlist()}))}})},changeOwner(){this.modelName="",w({title:"确定将管理权限转移给该成员吗?",success:e=>{e.confirm&&this.$api.msgApi.changeOwner({id:this.group_id,user_id:this.curUser.user_id}).then((e=>{0==e.code&&m({url:"/pages/index/index"})}))}})},search(){const e=JSON.parse(JSON.stringify(this.allUser));this.userList=this.$util.searchObject(e,["realname","name_py"],this.keywords)},openChatDetail(e){if(this.userInfo.user_id==e.user_id)return;let t=E.getContact(e.user_id),s=E.getContact(this.group_id);if(!(s.role<3||"1"==s.setting.profile||t))return C({title:"已开启用户隐私！",icon:"none"}),!1;p({url:"/pages/contacts/detail?id="+e.user_id})},showNoSpeak(){this.modelName="",this.$refs.nospeak.open()},setTime(e){console.log(e),this.noSpeakTimer=e},setNoSpeak(){this.$refs.nospeak.close(),this.$api.msgApi.setNoSpeak({id:this.group_id,user_id:this.curUser.user_id,noSpeakDay:this.noSpeakDay,noSpeakTimer:this.noSpeakTimer}).then((e=>{this.noSpeakTimer=0,this.noSpeakDay=1,0==e.code&&this.getGroupuserlist()}))},noSpeakExp(e){return 1e3*e>(new Date).getTime()&&this.$util.date("m-d H:i",e)}}},[["render",function(e,a,p,h,m,f){const y=T("cu-custom"),k=d,b=N,S=c,x=T("Empty"),w=U(g("uni-list-item"),O),C=U(g("uni-number-box"),L),B=U(g("uni-list"),z),D=A,E=U(g("uni-popup"),j);return t(),s(S,null,{default:i((()=>[_(y,{bgColor:"bg-video",isBack:!0},{backText:i((()=>[])),content:i((()=>[n("群成员")])),_:1}),_(S,{class:"cu-bar bg-video search fixed",style:o([{top:e.CustomBar+"px"}])},{default:i((()=>[_(S,{class:"search-form round"},{default:i((()=>[_(k,{class:"cuIcon-search"}),_(b,{type:"text",modelValue:m.keywords,"onUpdate:modelValue":a[0]||(a[0]=e=>m.keywords=e),placeholder:"输入搜索的关键词","confirm-type":"search"},null,8,["modelValue"])])),_:1})])),_:1},8,["style"]),_(S,{style:{"margin-top":"104rpx"}},{default:i((()=>[_(S,{class:"cu-list menu-avatar"},{default:i((()=>[(t(!0),v($,null,I(m.userList,(e=>(t(),s(S,{class:"cu-item"},{default:i((()=>[_(S,{class:"cu-avatar lg",style:o("background-image:url("+e.userInfo.avatar+");"),onClick:t=>f.openChatDetail(e)},null,8,["style","onClick"]),_(S,{class:"content"},{default:i((()=>[_(S,{class:"text-grey"},{default:i((()=>[_(S,{class:"text-cut"},{default:i((()=>[n(r(e.userInfo.displayName),1)])),_:2},1024),e.role<3?(t(),s(S,{key:0,class:l(["cu-tag round sm",1==e.role?"bg-red":"bg-orange"])},{default:i((()=>[n(r(1==e.role?"群主":2==e.role?"管理员":""),1)])),_:2},1032,["class"])):u("",!0),e.user_id==m.userInfo.user_id?(t(),s(S,{key:1,class:"cu-tag round sm"},{default:i((()=>[n("我")])),_:1})):u("",!0)])),_:2},1024),f.noSpeakExp(e.no_speak_time)?(t(),s(S,{key:0,class:"text-red text-xs"},{default:i((()=>[n("禁言至："+r(f.noSpeakExp(e.no_speak_time)),1)])),_:2},1024)):u("",!0)])),_:2},1024),_(S,{class:"action",onClick:t=>f.openModel(e)},{default:i((()=>[_(S,{class:"text-grey text-sm"},{default:i((()=>[e.role>1&&m.isAuth?(t(),s(k,{key:0,class:"cuIcon-more f-24"})):u("",!0)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),256)),m.userList.length?u("",!0):(t(),s(x,{key:0,noDatatext:"未搜索到数据",textcolor:"#999"}))])),_:1})])),_:1}),_(S,{class:l(["cu-modal bottom-modal","userOpt"==m.modelName?"show":""])},{default:i((()=>[_(S,{class:"cu-dialog"},{default:i((()=>[_(S,{class:"manage-content"},{default:i((()=>[_(S,{class:"cu-list menu bg-video"},{default:i((()=>[m.curUser?(t(),s(S,{key:0,class:"cu-item"},{default:i((()=>[_(S,{class:"content im-flex im-justify-content-center im-align-items-center"},{default:i((()=>[_(S,{class:"cu-avatar round sm",style:o("background-image:url("+m.curUser.avatar+");")},null,8,["style"]),_(S,{class:"text-cut ml-5"},{default:i((()=>[n(r(m.curUser.realname),1)])),_:1}),2==m.curUser.role?(t(),s(S,{key:0,class:"cu-tag round sm bg-orange"},{default:i((()=>[n("管理员")])),_:1})):u("",!0)])),_:1})])),_:1})):u("",!0),m.isAdmin?(t(),s(S,{key:1,class:"cu-item",onClick:a[1]||(a[1]=e=>f.changeOwner())},{default:i((()=>[_(S,{class:"content padding-tb-sm"},{default:i((()=>[_(k,{class:"c-orange"},{default:i((()=>[n("转让管理权限")])),_:1})])),_:1})])),_:1})):u("",!0),m.isAdmin?(t(),s(S,{key:2,class:"cu-item",onClick:a[2]||(a[2]=e=>f.setManage())},{default:i((()=>[_(S,{class:"content padding-tb-sm"},{default:i((()=>[_(k,null,{default:i((()=>[n(r(2==m.curUser.role?"取消管理员":"设为管理员"),1)])),_:1})])),_:1})])),_:1})):u("",!0),m.isAdmin?(t(),s(S,{key:3,class:"cu-item",onClick:a[3]||(a[3]=e=>f.showNoSpeak())},{default:i((()=>[_(S,{class:"content padding-tb-sm"},{default:i((()=>[_(k,null,{default:i((()=>[n("设置禁言")])),_:1})])),_:1})])),_:1})):u("",!0),_(S,{class:"cu-item",onClick:a[4]||(a[4]=e=>f.removeUser())},{default:i((()=>[_(S,{class:"content padding-tb-sm"},{default:i((()=>[_(k,null,{default:i((()=>[n("移出群聊")])),_:1})])),_:1})])),_:1}),_(S,{class:"cu-item",onClick:a[5]||(a[5]=e=>m.modelName="")},{default:i((()=>[_(S,{class:"content padding-tb-sm"},{default:i((()=>[_(k,{class:"c-red"},{default:i((()=>[n("取消")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class"]),_(E,{ref:"nospeak",type:"share",safeArea:"",backgroundColor:"#fff"},{default:i((()=>[_(B,null,{default:i((()=>[(t(!0),v($,null,I(m.noSpeakList,((e,a)=>(t(),s(w,{clickable:"",title:e.name,onClick:t=>f.setTime(e.id)},{footer:i((()=>[m.noSpeakTimer==e.id?(t(),s(k,{key:0,class:"cuIcon-check c-green"})):u("",!0)])),_:2},1032,["title","onClick"])))),256)),_(w,{title:"自定义",clickable:"",onClick:a[6]||(a[6]=e=>f.setTime(0))},{footer:i((()=>[_(C,{min:1,max:365,value:m.noSpeakDay},null,8,["value"]),n(" 天 ")])),_:1})])),_:1}),_(S,{class:"padding flex flex-direction mt-10"},{default:i((()=>[_(D,{class:"cu-btn bg-green lg",onClick:a[7]||(a[7]=e=>f.setNoSpeak())},{default:i((()=>[n("确定")])),_:1})])),_:1})])),_:1},512)])),_:1})}],["__scopeId","data-v-eb935c7f"]]);export{F as default};
