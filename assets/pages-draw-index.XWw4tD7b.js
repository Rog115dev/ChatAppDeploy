import{_ as t,o as e,c as r,w as s,a as i,f as a,aa as l,m as n,b as o,F as d,d as g,e as c,t as u,l as h,g as p,i as f,q as y,s as w,G as m,C as _,r as b,ac as $}from"./index-BWCeDMGH.js";import{r as z}from"./uni-app.es.BSjB11UY.js";/* empty css                     */const S=t({name:"l-dialer",emits:["click","done"],props:{size:{type:[String,Number],default:300},prizeList:{type:Array},turns:{type:Number,default:10},duration:{type:Number,default:3},styleOpt:{type:Object,default:()=>({prizeBgColors:["#fff0a3","#fffce6"],borderColor:"#ffd752"})},customStyle:{type:String},dialStyle:{type:String},pointerStyle:{type:String,default:"width: 30%"}},data:()=>({startRotateDegree:0,rotateAngle:0,rotateTransition:"",isTurnIng:!1}),computed:{getStyleOpt(){return Object.assign({prizeBgColors:["#fff0a3","#fffce6"],borderColor:"#ffd752"},this.styleOpt)},getRotateAngle(){return t=>{const e={transform:`rotate(${360/this.prizeList.length*t}deg) skewX(0deg) skewY(${360/this.prizeList.length-90}deg)`,backgroundColor:`${this.getStyleOpt.prizeBgColors[t%this.getStyleOpt.prizeBgColors.length]}`,border:`${this.getStyleOpt.borderColor&&"1rpx solid "+this.getStyleOpt.borderColor}`};return 2==this.prizeList.length&&(e.transform=0==t?0:"rotate(270deg)",e.top=0),e}},getCorrectAngle(){return t=>{const e={transform:`skewY(${90-360/this.prizeList.length}deg) skewX(0deg) rotate(${180/this.prizeList.length}deg)`};return 2==this.prizeList.length&&(0==t?(e.transform="rotate(90deg)",e.bottom=0):(e.transform="rotate(0deg)",e.left=0,e.bottom="-50%")),e}},getStyle(){let{size:t,customStyle:e}=this;return t=/\d$/.test(t)?t+"px":t,`width: ${t}; height: ${t}; ${e}`},getDialStyle(){return`\n\t\t\t\tpadding: ${this.getStyleOpt.padding};\n\t\t\t\ttransform: ${this.rotateAngle};\n\t\t\t\ttransition: ${this.rotateTransition};\n\t\t\t\t${this.dialStyle}\n\t\t\t`}},methods:{run(t){if(this.isTurnIng)return;const e=this.duration,r=this.prizeList.length,s=this.startRotateDegree+360*this.turns+360-(180/r+360/r*t)-this.startRotateDegree%360;this.startRotateDegree=s,this.rotateAngle=`rotate(${s}deg)`,this.rotateTransition=`transform ${e}s cubic-bezier(0.250, 0.460, 0.455, 0.995)`,this.isTurnIng=!0,setTimeout((()=>{this.$emit("done",t),this.isTurnIng=!1}),1e3*e+500)}}},[["render",function(t,y,w,m,_,b){const $=p,z=f;return e(),r($,{class:"l-dialer",style:a(b.getStyle)},{default:s((()=>[i($,{class:"l-dialer__inner",style:a(b.getDialStyle)},{default:s((()=>[t.$slots.border?(e(),r($,{key:0,class:"l-dialer__inner-border"},{default:s((()=>[l(t.$slots,"border",{},void 0,!0)])),_:3})):n("",!0),i($,{class:"l-dialer__inner-wrap",style:a(w.styleOpt.borderColor&&" border: 1rpx solid "+w.styleOpt.borderColor)},{default:s((()=>[(e(!0),o(d,null,g(w.prizeList,((n,g)=>(e(),r($,{class:"l-dialer__inner-item",key:g,style:a([b.getRotateAngle(g)])},{default:s((()=>[i($,{class:"l-dialer__inner-content",style:a([b.getCorrectAngle(g)])},{default:s((()=>[t.$slots.prize?l(t.$slots,"prize",{key:0,item:n,even:g%2},void 0,!0):(e(),o(d,{key:1},[i($,{class:"l-dialer__inner-name",style:a([{fontSize:w.styleOpt.fontSize,color:w.styleOpt.color}])},{default:s((()=>[c(u(n.name),1)])),_:2},1032,["style"]),i(z,{class:"l-dialer__inner-img",src:n.img},null,8,["src"])],64))])),_:2},1032,["style"])])),_:2},1032,["style"])))),128))])),_:3},8,["style"])])),_:3},8,["style"]),i($,{class:"l-dialer__pointer",style:a(w.pointerStyle)},{default:s((()=>[t.$slots&&t.$slots.pointer?l(t.$slots,"pointer",{key:0},void 0,!0):(e(),r(z,{key:1,class:h(_.isTurnIng?"":"heart"),src:"/assets/turnable_btn-DZyHcst9.png",style:{width:"100%"},mode:"widthFix",onClick:y[0]||(y[0]=e=>t.$emit("click"))},null,8,["class"]))])),_:3},8,["style"])])),_:3},8,["style"])}],["__scopeId","data-v-c317bbca"]]),C=y(w);const D=t({data:()=>({prizeList:[],drawing:!1,count:0,reward:{index:0,reward:0},globalConfig:C.globalConfig}),onShow(){this.loadData()},methods:{loadData(){this.$api.drawApi.getDrawData().then((t=>{0==t.code&&(this.prizeList=t.data.draws,this.count=t.data.count),this.reward={index:0,reward:0}}))},async handleDraw(){if(this.drawing)return;if(this.drawing=!0,this.count<=0)return this.drawing=!1,void m({title:"暂无抽奖机会",icon:"none"});let t=await this.$api.drawApi.doDraw();0==t.code?(this.reward=t.data,this.$refs.dialer.run(this.reward.index)):(this.drawing=!1,m({title:t.msg,icon:"none"}))},handleDown(){if(console.log(this.reward),this.drawing=!1,1!=this.reward.reward)return this.loadData(),void m({title:"很抱歉，未中奖",icon:"none"});let t=`恭喜您获得【${this.prizeList[this.reward.index].name}】`;this.loadData(),m({title:t,icon:"none"})}}},[["render",function(t,r,l,n,g,h){const f=$,y=_("cu-custom"),w=z(b("l-dialer"),S),m=p;return e(),o(d,null,[i(y,{bgColor:"bg-gradual-green",isBack:!0},{backText:s((()=>[])),content:s((()=>[c("幸运抽奖")])),right:s((()=>[i(f,{url:"/pages/draw/log",class:"nav-right"},{default:s((()=>[c("中奖记录")])),_:1})])),_:1}),i(m,{class:"container",style:a({height:`calc(100% - ${t.CustomBar}px)`})},{default:s((()=>[i(m,{class:"content-wrapper"},{default:s((()=>[i(w,{prizeList:g.prizeList,onClick:h.handleDraw,onDone:h.handleDown,ref:"dialer"},null,8,["prizeList","onClick","onDone"]),i(m,{class:"my-count"},{default:s((()=>[c("抽奖次数："+u(g.count),1)])),_:1})])),_:1}),i(m,{class:"draw-desc"},{default:s((()=>[i(m,{class:"draw-desc-title"},{default:s((()=>[c("抽奖规则")])),_:1}),i(m,{class:"ql-wrapper ql-container ql-snow"},{default:s((()=>[i(m,{class:"ql-editor",innerHTML:g.globalConfig.draw.rule},null,8,["innerHTML"])])),_:1})])),_:1})])),_:1},8,["style"])],64)}],["__scopeId","data-v-c0246237"]]);export{D as default};
