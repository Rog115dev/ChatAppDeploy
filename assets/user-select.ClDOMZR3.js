import{q as e,s,_ as t,x as a,r as l,C as i,o as r,c,w as o,a as u,e as d,m as n,b as h,d as p,F as m,t as f,j as g,ab as y,g as U,X as _,i as b}from"./index-CDOpH1f_.js";import{a as k}from"./uni-data-checkbox.CZPgkyXT.js";import{r as L}from"./uni-app.es.DwBKReRU.js";const x=e(s);const I=t({name:"user-select",props:{type:{type:Number,default:0},contact_id:{type:String,default:""},multiple:{type:Boolean,default:!0},user_ids:{type:Object,default:{}}},data:()=>({lists:[],keywords:"",searchList:[],selectUser:[],userList:[],changeUser:[],scrollLeft:300,contacList:[],searcheUser:[],isAuth:!1,userInfo:x.userInfo}),watch:{keywords(e){this.search(),""!=e&&(this.searcheUser=this.changeUser)},searcheUser(e){const s=this.changeUser.concat(e);this.changeUser=[...new Set(s)]}},mounted(){4==this.type?this.getGroupUser():this.getAllUser();let e=JSON.parse(JSON.stringify(this.userList));this.lists=e},methods:{getAllUser(){const e=a("allContacts");let s=[];3==this.type?(s=e.filter((e=>e.id!=this.contact_id)),s.forEach((e=>{e.disable=!1;let s=e.displayName;e.is_group&&(s+="（群聊）"),e.text=s,e.value=e.id}))):(s=e.filter((e=>0==e.is_group)),this.contacList=JSON.parse(JSON.stringify(s)),s.forEach((e=>{e.disable=!1,e.text=e.displayName,e.value=e.id,this.user_ids.length&&2==this.type&&this.user_ids.includes(e.id)&&(e.disable=!0)})),1==this.type&&this.contact_id&&(this.changeUser.push(parseInt(this.contact_id)),this.selectUser=s.filter((e=>e.id==this.contact_id)))),this.userList=s,this.lists=s},getGroupUser(){this.userList=[],this.$api.msgApi.groupUserList({group_id:this.contact_id}).then((e=>{e.data.filter((e=>(1==e.role||2==e.role)&&e.userInfo.id==this.userInfo.user_id)).length&&(this.isAuth=!0);e.data.forEach(((e,s)=>{e.realname=e.userInfo.displayName,e.displayName=e.userInfo.displayName,e.avatar=e.userInfo.avatar,e.name_py=e.userInfo.name_py,e.disable=!1,e.text=e.userInfo.displayName,e.value=e.userInfo.id}));const s=e.data.filter((e=>e.userInfo.id!=this.userInfo.user_id));this.lists=s,this.userList=s}))},chooseUser(e){this.multiple?this.selectUser=e.detail.data:this.selectUser=[e.detail.data],setTimeout((()=>{this.scrollLeft+=300}),50)},atAll(){this.$emit("setData",{realname:"所有人",user_id:0})},chooseSearchUser(e){this.multiple?this.selectUser=this.$util.mergeArrays(e.detail.data,this.selectUser):this.selectUser=[e.detail.data],setTimeout((()=>{this.scrollLeft+=300}),50)},removeUser(e,s){this.selectUser=this.selectUser.filter((s=>s.id!=e)),this.changeUser=this.changeUser.filter((e=>e!=s))},search:function(e){let s=JSON.parse(JSON.stringify(this.lists));this.searchList=this.$util.searchObject(s,["displayName","name_py"],this.keywords)},confirm:function(e){let s=[];e&&(this.userList.filter((t=>{let a=t.realname?t.realname:t.userInfo.displayName;return a.includes(e.trim())&&s.push(t),a.includes(e.trim())})),this.lists=s)}}},[["render",function(e,s,t,a,x,I){const v=g,N=y,w=U,C=L(l("uni-data-checkbox"),k),S=i("Empty"),A=b,V=_;return r(),c(w,null,{default:o((()=>[u(w,{class:"cu-bar bg-video search"},{default:o((()=>[u(w,{class:"search-form round"},{default:o((()=>[u(v,{class:"cuIcon-search"}),u(N,{type:"text",modelValue:x.keywords,"onUpdate:modelValue":s[0]||(s[0]=e=>x.keywords=e),placeholder:"输入搜索的关键词","confirm-type":"search"},null,8,["modelValue"])])),_:1})])),_:1}),x.keywords?n("",!0):(r(),c(w,{key:0,class:"gui-padding",style:{"padding-bottom":"120rpx"}},{default:o((()=>[u(w,{class:"cu-list menu"},{default:o((()=>[x.isAuth?(r(),c(w,{key:0,class:"cu-item arrow",onClick:I.atAll},{default:o((()=>[u(w,{class:"cu-avatar mr-15 group-bg sm"}),u(w,{class:"content"},{default:o((()=>[u(v,{class:"c-333"},{default:o((()=>[d("所有人")])),_:1})])),_:1})])),_:1},8,["onClick"])):n("",!0)])),_:1}),u(C,{multiple:t.multiple,class:"user-list-select",onChange:I.chooseUser,modelValue:x.changeUser,"onUpdate:modelValue":s[1]||(s[1]=e=>x.changeUser=e),localdata:x.lists},null,8,["multiple","onChange","modelValue","localdata"]),x.lists.length?n("",!0):(r(),c(S,{key:0,noDatatext:"无联系人",textcolor:"#999"}))])),_:1})),x.keywords?(r(),c(w,{key:1,class:"gui-padding",style:{"padding-bottom":"120rpx"}},{default:o((()=>[u(C,{multiple:t.multiple,class:"user-list-select",onChange:I.chooseSearchUser,modelValue:x.searcheUser,"onUpdate:modelValue":s[2]||(s[2]=e=>x.searcheUser=e),localdata:x.searchList},null,8,["multiple","onChange","modelValue","localdata"]),x.searchList.length?n("",!0):(r(),c(S,{key:0,noDatatext:"未搜索到数据",textcolor:"#999"}))])),_:1})):n("",!0),u(w,{class:"cu-bar bg-video tabbar border shop footer-opt"},{default:o((()=>[u(V,{class:"scroll-view_H","scroll-x":"true","scroll-anchoring":!0,"scroll-left":x.scrollLeft},{default:o((()=>[u(w,{class:"user-list-avatar"},{default:o((()=>[(r(!0),h(m,null,p(x.selectUser,((e,s)=>(r(),c(A,{key:s,class:"user-avatar",src:e.avatar,onClick:s=>I.removeUser(e.id,e.user_id)},null,8,["src","onClick"])))),128))])),_:1}),u(w,{class:"select-num pd-10"},{default:o((()=>[d("已选"+f(x.selectUser.length)+"人",1)])),_:1})])),_:1},8,["scroll-left"])])),_:1})])),_:1})}],["__scopeId","data-v-c85ea56e"]]);export{I as u};
