import{_ as s,q as e,s as t,A as a,B as l,G as i,ai as o,P as c,a5 as n,x as r,M as d,C as m,b as u,a as g,w as f,f as h,F as p,g as _,o as k,e as C,c as b,d as y,m as w,l as V,ae as I,am as v,W as x,j as T,i as j}from"./index-nIaQZq1w.js";const A=e(t);const $=s({data:()=>({form:{content:"",imgs:[]},loading:!1,show:!1,globalConfig:A.globalConfig,isVideo:!1}),methods:{clear(){this.isVideo=!1,this.$set(this.form,"imgs",[])},deleteImg(s){let e=this.form.imgs.filter((e=>e.src!==s.src));this.$set(this.form,"imgs",e)},publish(){if(this.loading=!0,a({mask:!0}),!this.form.content)return this.loading=!1,l(),void i({title:"请输入内容",icon:"error"});this.$api.circleApi.publish(this.form).then((s=>{l(),this.loading=!1,i({title:s.msg,icon:"none"}),0==s.code&&(this.form={content:"",imgs:[]},this.isVideo=!1)}))},showImgs:function(s){var e=s.currentTarget.dataset.img;o({urls:this.form.imgs.map((s=>s.img_url_addr)),current:e})},chooseVideo(){if(this.form.imgs.length>0)return void i({title:"只能单独上传一个视频",icon:"none"});let s=this;c({sourceType:["camera","album"],compressed:!1,success:e=>{const t=e.tempFilePath;let a=s.globalConfig.fileUpload.size??10;if(e.size>1024*a*1024)return i({title:"文件大小不能超过"+a+"M",icon:"error"});n({url:s.$api.msgApi.uploadUrl,filePath:t,name:"file",header:{Authorization:r("authToken")},success:e=>{let t=JSON.parse(e.data);0==t.code&&(s.form.imgs.push(t.data),s.isVideo=!0)},fail:s=>{}})}})},chooseImg(){if(9===this.form.imgs.length)return void i({title:"最多上传9张图片",icon:"error"});if(this.form.imgs.length>0&&this.form.imgs[0].poster)return void i({title:"只能单独上传一个视频",icon:"none"});let s=this;d({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{e.tempFiles.forEach((e=>{n({url:this.$api.msgApi.uploadUrl,filePath:e.path,name:"file",header:{Authorization:r("authToken")},success:e=>{let t=JSON.parse(e.data);s.form.imgs.push(t.data)},fail:s=>{i({title:"图片上传失败，请重新上传",icon:"error"})}})}))}})}}},[["render",function(s,e,t,a,l,i){const o=_,c=m("cu-custom"),n=I,r=j,d=v,A=x,$=T;return k(),u(p,null,[g(c,{bgColor:"bg-gradual-green",isBack:!0},{backText:f((()=>[])),content:f((()=>[C("发表")])),right:f((()=>[g(o,{class:"mr-10 f-16",onClick:e[0]||(e[0]=s=>l.show=!0)},{default:f((()=>[C("添加素材")])),_:1})])),_:1}),g(o,{class:"container",style:h({height:`calc(100% - ${s.CustomBar}px)`})},{default:f((()=>[g(n,{class:"text-area",maxlength:-1,"placeholder-class":"text-area-placeholder",modelValue:l.form.content,"onUpdate:modelValue":e[1]||(e[1]=s=>l.form.content=s),placeholder:"请输入内容","auto-focus":"","auto-height":""},null,8,["modelValue"]),g(o,{class:"img-wrapper"},{default:f((()=>[l.isVideo?(k(),b(d,{key:1,class:"video",src:l.form.imgs[0].preview,controls:"",poster:l.form.imgs[0].poster},null,8,["src","poster"])):(k(),b(o,{key:0,class:"img-list"},{default:f((()=>[(k(!0),u(p,null,y(l.form.imgs,((s,e)=>(k(),b(o,{class:"img-item-wrapper",key:e},{default:f((()=>[g(r,{class:"image-item",mode:"aspectFit",onClick:i.showImgs,src:s.img_url_addr,"data-img":s.img_url_addr},null,8,["onClick","src","data-img"]),g(o,{onClick:e=>i.deleteImg(s),class:"cuIcon-delete"},null,8,["onClick"])])),_:2},1024)))),128)),l.form.imgs.length<9?(k(),b(o,{key:0,class:"cuIcon-cameraadd",onClick:e[2]||(e[2]=s=>l.show=!0)})):w("",!0)])),_:1}))])),_:1}),g(A,{class:"opt-btn",loading:l.loading,type:"primary",onClick:i.publish},{default:f((()=>[C("发表")])),_:1},8,["loading","onClick"]),g(o,{class:V(["cu-modal bottom-modal",l.show?"show":""]),onClick:e[4]||(e[4]=s=>l.show=!1)},{default:f((()=>[g(o,{class:"cu-dialog"},{default:f((()=>[g(o,{class:"manage-content"},{default:f((()=>[g(o,{class:"cu-list menu bg-white"},{default:f((()=>[g(o,{class:"cu-item",onClick:i.chooseImg},{default:f((()=>[g(o,{class:"content padding-tb-sm",style:{"justify-content":"center"}},{default:f((()=>[g($,null,{default:f((()=>[C("上传图片")])),_:1})])),_:1})])),_:1},8,["onClick"]),g(o,{class:"cu-item",onClick:i.chooseVideo},{default:f((()=>[g(o,{class:"content padding-tb-sm",style:{"justify-content":"center"}},{default:f((()=>[g($,null,{default:f((()=>[C("上传视频")])),_:1})])),_:1})])),_:1},8,["onClick"]),g(o,{class:"cu-item",onClick:i.clear},{default:f((()=>[g(o,{class:"content padding-tb-sm",style:{"justify-content":"center"}},{default:f((()=>[g($,{class:"c-red"},{default:f((()=>[C("清空")])),_:1})])),_:1})])),_:1},8,["onClick"]),g(o,{class:"parting-line-5"}),g(o,{class:"cu-item",onClick:e[3]||(e[3]=s=>l.show=!1)},{default:f((()=>[g(o,{class:"content padding-tb-sm",style:{"justify-content":"center"}},{default:f((()=>[g($,{class:"c-red"},{default:f((()=>[C("取消")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1},8,["style"])],64)}],["__scopeId","data-v-973b28b9"]]);export{$ as default};
