import{_ as e,u as s,s as t,p as i,G as a,a4 as r,a0 as n,x as c,A as o,B as h,n as l,C as d,c as g,w as p,g as u,o as m,a as _,e as f,t as y}from"./index-BWCeDMGH.js";import{u as U}from"./user-select.BcmHJJey.js";import"./uni-data-checkbox.DU_Xpi6n.js";import"./uni-app.es.BSjB11UY.js";const $=s(t);i($);const v=e({components:{userSelect:U},data:()=>({title:"发起群聊",contact_id:"",selectUser:[],userList:[],changeUser:[],user_ids:[],type:1,relayState:!1,scrollLeft:300,curMsg:{},msg_ids:[]}),watch:{relayState(e){1==e&&(a({icon:"success",title:"转发成功"}),setTimeout((()=>{r()}),2e3))}},onLoad(e){var s=n(),t=s[s.length-2];this.type=e.type?e.type:1,this.contact_id=e.contact_id?e.contact_id:"",e.msg_ids&&(this.msg_ids=e.msg_ids.split(",")),2==e.type?(this.title="添加成员",this.user_ids=t.user_ids):3==e.type?(this.title="转发聊天",this.curMsg=t.curMsg):4==e.type?this.title="选择提醒的人":this.title="发起群聊"},methods:{relay(){let e=this.changeUser.map((e=>e.id));if(e.length)if(e.length>5)a({title:"转发的人数不能超过5人！",icon:"none"});else{var s=n(),t=s[s.length-2];let i="";i=t.fromUser,t.contact.id;let a="";a="relayCrm"==this.type||"relayProject"==this.type?t.message:c("selectedItem"),e.forEach((e=>{let s={id:this.$util.getUuid(),is_group:0,fromUser:i,extends:a.extends?a.extends:"",type:a.type,toContactId:e,content:a.content,sendTime:(new Date).getTime()};this.$api.msgApi.sendMessage(s).then((e=>{200===e.code&&(this.relayState=!0)}))}))}else a({title:"请选择至少一名人员",icon:"none"})},addGroupUser(e){var s=n(),t=s[s.length-2];t.getsimpleMessage=!1;let i=t.group_id;this.$api.msgApi.addGroupUser({user_ids:e,id:i}).then((e=>{200==e.code&&r()}))},addGroup(e){this.$api.msgApi.addGroup({user_ids:e}).then((e=>{200==e.code&&setTimeout((()=>{r()}),2e3)}))},save(){if(o({title:"保存中...",mask:!0}),this.changeUser=this.$refs.userSelect.changeUser,this.selectUser=this.$refs.userSelect.selectUser,console.log(this.changeUser),!this.changeUser.length)return a({title:"请选择人员",icon:"none"});try{if(1==this.type)this.$api.msgApi.addGroup({user_ids:this.changeUser}).then((e=>{h();const s=e.data;$.appendContacts(s),l({url:"/pages/message/chat?id="+s.id})}));else if(2==this.type)this.$api.msgApi.addGroupUser({user_ids:this.changeUser,id:this.contact_id}).then((e=>{this.closePage()}));else if(3==this.type){if(this.changeUser.length>5)return a({title:"单次转发不能超过5人",icon:"none"});this.$api.msgApi.forwardMessage({user_ids:this.changeUser,msg_id:this.msg_ids.length>0?this.msg_ids:[this.curMsg.msg_id+""]}).then((e=>{this.closePage()}))}else if(4==this.type){this.getOpenerEventChannel().emit("getAtList",this.selectUser),this.closePage()}else this.$api.msgApi.removeUser({user_ids:this.changeUser,id:this.contact_id}).then((e=>{this.closePage()}))}catch(e){console.info(e),this.closePage()}},closePage(){h(),r()},confirm:function(e){let s=[];e&&(this.userList.filter((t=>{let i=t.realname?t.realname:t.userInfo.displayName;return i.includes(e.trim())&&s.push(t),i.includes(e.trim())})),this.lists=s)}}},[["render",function(e,s,t,i,a,r){const n=u,c=d("cu-custom"),o=d("user-select");return m(),g(n,null,{default:p((()=>[_(c,{bgColor:"bg-video",isBack:!0},{backText:p((()=>[])),content:p((()=>[f(y(a.title),1)])),right:p((()=>[_(n,{class:"mr-10 f-16",onClick:r.save},{default:p((()=>[f(y(3==a.type?"转发":"完成"),1)])),_:1},8,["onClick"])])),_:1}),_(o,{type:a.type,contact_id:a.contact_id,user_ids:a.user_ids,ref:"userSelect"},null,8,["type","contact_id","user_ids"])])),_:1})}],["__scopeId","data-v-518f6a37"]]);export{v as default};
