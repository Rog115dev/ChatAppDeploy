import{_ as e,q as t,s,n as i,G as l,O as r,z as o,ai as a,C as c,r as n,b as d,a as m,w as u,f as h,F as g,g as f,o as p,e as _,t as k,l as C,c as y,d as x,ac as I,i as b,j as S,X as v,ae as w,m as O}from"./index-CDOpH1f_.js";import{_ as $}from"./uni-popup.CzDYXpcs.js";import{r as j}from"./uni-app.es.DwBKReRU.js";import{_ as R}from"./bg.D0iaoRNn.js";const J=t(s);const N=e({data:()=>({JSONObj:JSON,page:1,limit:20,last_id:0,records:[],isRefreshing:!1,loginStore:J,globalConfig:J.globalConfig,appSetting:J.appSetting,currentCircle:{},currentCircleIndex:null,comment:{comment:""}}),onShow(){this.getList()},methods:{goPerson(e){i({url:`/pages/circle/person?id=${e.user_id}&realname=${e.realname}&avatar=${e.avatar}`})},play(e){e.src.split("/").reverse(),i({url:"/pages/message/video?name=video&src="+encodeURI(e.preview),animationType:"slide-in-bottom"})},openComment(e,t){this.comment={comment:""},this.currentCircle=e,this.currentCircleIndex=t,this.$refs.comment.open()},reply(e,t,s){this.comment={comment:""},this.currentCircle=e,this.currentCircleIndex=t,this.comment.is_reply=!0,this.comment.to_user_id=s.user_id,this.comment.to_realname=s.realname,this.$refs.comment.open()},submit(){if(!this.comment.comment)return void l({title:"评论不能为空"});let e={id:this.currentCircle.id,comment:this.comment.comment};this.comment.is_reply&&(e.to_user_id=this.comment.to_user_id,e.to_realname=this.comment.to_realname),this.$api.circleApi.comment(e).then((e=>{0==e.code&&(this.records[this.currentCircleIndex].comment||(this.records[this.currentCircleIndex].comment=[]),this.records[this.currentCircleIndex].comment.push(e.data),this.$forceUpdate(),r(),this.$refs.comment.close(),this.comment={comment:""}),l({title:e.msg,icon:"none"})}))},deleteCircle(e,t){let s=this;o({title:"提示",content:"确定删除该内容？",confirmText:"删除",cancelText:"取消",success(i){i.confirm&&s.$api.circleApi.delCircle({id:e.id}).then((e=>{0==e.code&&s.records.splice(t,1),l({title:e.msg,icon:"none"})}))}})},delComment(e,t){let s=this;o({title:"提示",content:"删除该评论？",confirmText:"删除",cancelText:"取消",success(i){i.confirm&&s.$api.circleApi.uncomment({id:e,cid:t}).then((i=>{if(0==i.code){let i=s.records.findIndex((t=>t.id===e));i>=0&&(s.records[i].comment=s.records[i].comment.filter((e=>!(e.user_id===s.loginStore.userInfo.user_id&&e.id===t))))}l({title:i.msg,icon:"none"})}))}})},like(e,t){this.$api.circleApi.like(e).then((e=>{0==e.code&&(this.records[t].like||(this.records[t].like=[]),this.records[t].like.push({user_id:this.loginStore.userInfo.user_id,realname:this.loginStore.userInfo.realname}),this.$forceUpdate()),l({title:e.msg,icon:"none"})}))},unlike(e,t){this.$api.circleApi.unlike(e).then((e=>{0==e.code&&(this.records[t].like=this.records[t].like.filter((e=>e.user_id!==this.loginStore.userInfo.user_id))),l({title:e.msg,icon:"none"})}))},getList(){this.$api.circleApi.circleList({page:this.page,limit:this.limit,last_id:this.last_id}).then((e=>{0==e.code&&e.data.data.length>0&&(this.records=[...this.records,...e.data.data],this.records.length>0&&(this.last_id=this.records[this.records.length-1].id))}))},showImgs:function(e){var t=e.currentTarget.dataset.img;a({urls:[t],current:t})},onRefresh(){this.isRefreshing=!0,this.records=[],this.last_id=0,this.getList(),setTimeout((()=>{this.isRefreshing=!1}),1e3)},loadMore(){this.getList()}}},[["render",function(e,t,s,i,l,r){const o=I,a=c("cu-custom"),J=b,N=S,T=f,A=v,F=w,M=j(n("uni-popup"),$);return p(),d(g,null,[m(a,{bgColor:"bg-gradual-green",isBack:!0},{backText:u((()=>[])),content:u((()=>[_("朋友圈")])),right:u((()=>[m(o,{style:{"padding-right":"10px"},url:"/pages/circle/publish"},{default:u((()=>[_("发布")])),_:1})])),_:1}),m(T,{class:"container",style:h({height:`calc(100% - ${e.CustomBar}px)`})},{default:u((()=>[m(A,{class:"circle-list-wrapper","show-scrollbar":!1,"scroll-y":"","refresher-enabled":"","refresher-triggered":l.isRefreshing,onRefresherrefresh:r.onRefresh,onScrolltolower:r.loadMore},{default:u((()=>[m(T,{class:"header"},{default:u((()=>[m(J,{class:"circle-bg",src:R}),m(T,{class:"self-info"},{default:u((()=>[m(N,{class:"self-info-uname"},{default:u((()=>[_(k(l.loginStore.userInfo.realname),1)])),_:1}),m(T,{class:C(["cu-avatar lg",l.appSetting.circleAvatar?"round":"radius"]),onClick:t[0]||(t[0]=e=>r.goPerson(l.loginStore.userInfo)),style:h([{backgroundImage:"url("+l.loginStore.userInfo.avatar+")"}])},null,8,["class","style"])])),_:1})])),_:1}),l.records.length>0?(p(),y(T,{key:0,class:"record-list"},{default:u((()=>[(p(!0),d(g,null,x(l.records,((e,t)=>(p(),y(T,{class:"circle-item",key:t},{default:u((()=>[m(T,{class:C(["circle-avatar cu-avatar lg",l.appSetting.circleAvatar?"round":"radius"]),onClick:t=>r.goPerson(e),style:h([{backgroundImage:"url("+e.avatar+")"}])},null,8,["onClick","class","style"]),m(T,{class:"circle-content"},{default:u((()=>[m(T,{class:"circle-uname"},{default:u((()=>[_(k(e.realname),1)])),_:2},1024),m(T,{class:"circle-desc"},{default:u((()=>[_(k(e.content),1)])),_:2},1024),l.JSONObj.parse(e.imgs).length>0&&l.JSONObj.parse(e.imgs)[0].poster?(p(),y(T,{key:0,class:"circle-video",onClick:t=>r.play(l.JSONObj.parse(e.imgs)[0])},{default:u((()=>[m(T,{class:"video-wrapper"},{default:u((()=>[m(T,{class:"video-mask"},{default:u((()=>[m(T,{class:"cuIcon-video icon-center f-28 c-white"})])),_:1}),m(J,{src:l.JSONObj.parse(e.imgs)[0].poster,mode:"aspectFit"},null,8,["src"])])),_:2},1024)])),_:2},1032,["onClick"])):(p(),y(T,{key:1,class:"circle-image"},{default:u((()=>[l.JSONObj.parse(e.imgs).length>1?(p(!0),d(g,{key:0},x(l.JSONObj.parse(e.imgs),((e,t)=>(p(),y(J,{key:t,class:"image-item",mode:"aspectFill",onClick:r.showImgs,src:e.img_url_addr,"data-img":e.img_url_addr},null,8,["onClick","src","data-img"])))),128)):(p(!0),d(g,{key:1},x(l.JSONObj.parse(e.imgs),((e,t)=>(p(),d(g,{key:t},[e.fixMode<=2?(p(),y(J,{key:0,src:e.img_url_addr,class:"radius",mode:1==e.fixMode?"widthFix":"heightFix",style:h(1==e.fixMode?"width:200px":""),onClick:r.showImgs,"data-img":e.img_url_addr},null,8,["src","mode","style","onClick","data-img"])):O("",!0),3==e.fixMode?(p(),y(J,{key:1,src:e.img_url_addr,class:"radius",mode:"scaleToFill",style:h([{width:e.width+"px",height:e.height+"px"}]),onClick:r.showImgs,"data-img":e.img_url_addr},null,8,["src","style","onClick","data-img"])):O("",!0)],64)))),128))])),_:2},1024)),m(T,{class:"circle-bottom"},{default:u((()=>[m(T,{class:"circle-time"},{default:u((()=>[_(k(e.create_time),1)])),_:2},1024),m(T,{class:"circle-opr"},{default:u((()=>[e.like&&e.like.findIndex((e=>e.user_id===l.loginStore.userInfo.user_id))>=0?(p(),y(T,{key:0,onClick:s=>r.unlike(e,t)},{default:u((()=>[_("取消")])),_:2},1032,["onClick"])):(p(),y(T,{key:1,onClick:s=>r.like(e,t)},{default:u((()=>[_("点赞")])),_:2},1032,["onClick"])),m(T,{onClick:s=>r.openComment(e,t)},{default:u((()=>[_("评论")])),_:2},1032,["onClick"]),e.user_id===l.loginStore.userInfo.user_id?(p(),y(T,{key:2,onClick:s=>r.deleteCircle(e,t)},{default:u((()=>[_("删除")])),_:2},1032,["onClick"])):O("",!0)])),_:2},1024)])),_:2},1024),e.like&&e.like.length>0||e.comment&&e.comment.length>0?(p(),y(T,{key:2,class:"circle-comment"},{default:u((()=>[e.like&&e.like.length>0?(p(),y(T,{key:0,class:C(["comment-good cuIcon-likefill",e.like&&e.like.findIndex((e=>e.user_id===l.loginStore.userInfo.user_id))>=0?"like-red":""])},{default:u((()=>[m(T,{class:"comment-good-list"},{default:u((()=>[_(k(e.like.map((e=>e.realname)).join("，")),1)])),_:2},1024)])),_:2},1032,["class"])):O("",!0),m(T,{class:"comment-list"},{default:u((()=>[(p(!0),d(g,null,x(e.comment,((s,i)=>(p(),y(T,{class:"comment-list-item",key:i},{default:u((()=>[m(T,{style:{display:"flex","flex-direction":"column",gap:"4px"}},{default:u((()=>[m(N,null,{default:u((()=>[_(k(s.to_user_id?`${s.realname}>${s.to_realname}`:s.realname)+"：",1)])),_:2},1024),m(N,null,{default:u((()=>[_(k(s.comment),1)])),_:2},1024)])),_:2},1024),s.user_id===l.loginStore.userInfo.user_id?(p(),y(T,{key:0,class:"comment-del",onClick:t=>r.delComment(e.id,s.id)},{default:u((()=>[_("删除")])),_:2},1032,["onClick"])):O("",!0),s.user_id!==l.loginStore.userInfo.user_id?(p(),y(T,{key:1,class:"comment-reply",onClick:i=>r.reply(e,t,s)},{default:u((()=>[_("回复")])),_:2},1032,["onClick"])):O("",!0)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):O("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(p(),y(T,{key:1,class:"empty-state"},{default:u((()=>[m(N,{class:"empty-text"},{default:u((()=>[_("暂无数据")])),_:1})])),_:1}))])),_:1},8,["refresher-triggered","onRefresherrefresh","onScrolltolower"]),m(M,{ref:"comment",type:"bottom","background-color":"#eeeeee",borderRadius:"20px 20px 0 0"},{default:u((()=>[m(T,{class:"comment-pop-content"},{default:u((()=>[m(F,{class:"comment-text-area",onConfirm:r.submit,"confirm-type":"send","show-confirm-bar":!1,"confirm-hold":!1,"placeholder-class":"text-area-placeholder",modelValue:l.comment.comment,"onUpdate:modelValue":t[1]||(t[1]=e=>l.comment.comment=e),placeholder:"请输入评论内容","auto-focus":"","auto-height":""},null,8,["onConfirm","modelValue"])])),_:1})])),_:1},512)])),_:1},8,["style"])],64)}],["__scopeId","data-v-d080a6a1"]]);export{N as default};
