import{_ as e,u as t,s,p as a,q as i,D as l,E as o,G as n,Z as c,T as d,C as r,r as m,c as u,w as f,g as p,o as g,a as h,e as x,b as y,d as _,F as w,f as k,m as b,l as C,j as v,ab as I,W as L,X as M,t as T,U as S,a7 as j,i as U}from"./index-CDOpH1f_.js";import{_ as H}from"./mp-html.CnUIoUfV.js";import{r as F}from"./uni-app.es.DwBKReRU.js";import{_ as N}from"./uni-pagination.CVQ65Nh9.js";import{i as P,a as z,c as B}from"./chat.HU7is2lA.js";import"./uni-icons.QhmNVcfb.js";const V=t(s);a(V);const q=i(s);const D=e({components:{imItem:P,imUser:z},mixins:[B],data:()=>({user:q.userInfo,modelName:"",messageList:[],tabBars:[{name:"全部",id:"all"},{name:"文本",id:"text"},{name:"图片",id:"image"},{name:"视频",id:"video"},{name:"文件",id:"file"}],scrollInto:"",isSearch:!1,dataTotal:0,emojiMap:[],isProfile:!1,bottomHeight:0,paddingT:0,params:{toContactId:0,is_group:0,type:"all",keywords:"",page:1,limit:10}}),computed:{scrollH:function(){let e=l(),t=750/e.windowWidth,s=o(100);this.bottomHeight=s;const a=this.getQuery();return setTimeout((()=>{a.select(".cu-header").boundingClientRect(),a.exec((e=>{this.paddingT=e[0].height}))}),10),parseInt((e.windowHeight-this.navBarHeight-this.paddingT)*t)+18}},onLoad:function(e){this.params.toContactId=e.id;let t=V.getContact(e.id);this.params.is_group=t.is_group,t?(this.contact=t,this.getMessageList(),1==t.is_group&&(t.role<3||"1"==t.setting.profile)&&(this.isProfile=!0)):n({title:"联系人不存在",icon:"none",duration:1500,complete:e=>{c({url:"/pages/index/index"})}})},methods:{getQuery:()=>d(),getMessageList(){this.$api.msgApi.getMessageList(this.params).then((e=>{let t=e.data;this.messageList=t,this.dataTotal=e.count}))},ontabtap(e){this.params.type!==e&&(this.params.type=e,this.params.page=1,this.scrollInto=e,this.getMessageList())},changePage(e){this.params.page=e.current,this.getMessageList()},search(){this.getMessageList()},switchSearch(){this.params.keywords="",this.isSearch=!this.isSearch,this.isSearch||this.getMessageList()}}},[["render",function(e,t,s,a,i,l){const o=p,n=r("cu-custom"),c=v,d=I,P=L,z=r("im-user"),B=F(m("mp-html"),H),V=U,q=r("imItem"),D=r("Empty"),E=F(m("uni-pagination"),N),Q=M;return g(),u(o,{style:{width:"100%","background-color":"#f1f1f1",height:"100vh"}},{default:f((()=>[h(n,{bgColor:"bg-gradual-green",isBack:!0,class:"cu-header"},{backText:f((()=>[])),content:f((()=>[x("聊天信息")])),right:f((()=>[h(o,{class:"cuIcon-search mr-10 f-16",onClick:t[0]||(t[0]=e=>l.switchSearch())})])),_:1}),h(o,{class:"cu-bar bg-white search fixed",style:k([{top:e.CustomBar+"px",minHeight:"80rpx",justifyContent:"flex-start"}])},{default:f((()=>[i.isSearch?(g(),y(w,{key:1},[h(o,{class:"search-form round"},{default:f((()=>[h(c,{class:"cuIcon-search"}),h(d,{type:"text",modelValue:i.params.keywords,"onUpdate:modelValue":t[1]||(t[1]=e=>i.params.keywords=e),placeholder:"请输入关键字搜索","confirm-type":"search"},null,8,["modelValue"])])),_:1}),h(o,{class:"action"},{default:f((()=>[h(P,{class:"cu-btn round bg-green",onClick:t[2]||(t[2]=e=>l.getMessageList())},{default:f((()=>[x("搜索")])),_:1})])),_:1})],64)):(g(!0),y(w,{key:0},_(i.tabBars,((e,t)=>(g(),u(o,{key:e.id,class:"uni-tab-item",id:e.id,"data-current":t,onClick:t=>l.ontabtap(e.id)},{default:f((()=>[h(c,{class:C(["uni-tab-item-title",i.params.type==e.id?"uni-tab-item-title-active":""])},{default:f((()=>[x(T(e.name),1)])),_:2},1032,["class"])])),_:2},1032,["id","data-current","onClick"])))),128))])),_:1},8,["style"]),h(Q,{class:"scroll-view-body",ref:"scrollView","scroll-y":!0,"scroll-anchoring":!0,style:k({height:l.scrollH+"rpx",position:"fixed",bottom:i.bottomHeight+"px"})},{default:f((()=>[h(o,{class:"cu-chat",style:{paddingTop:"100rpx"}},{default:f((()=>[(g(!0),y(w,null,_(i.messageList,((t,s)=>(g(),u(o,{key:s,class:"cu-item"},{default:f((()=>[h(z,{info:t.fromUser,profile:i.isProfile,onLongpress:s=>e.at(t.fromUser)},null,8,["info","profile","onLongpress"]),h(o,{class:"main im-wrap"},{default:f((()=>[h(o,{class:"f-12 c-666",style:{width:"100%","margin-bottom":"6rpx"}},{default:f((()=>[h(c,null,{default:f((()=>[x(T(t.fromUser.realname)+"   ",1)])),_:2},1024),h(c,{class:"f-11 c-999"},{default:f((()=>[x(T(e.sendTime(t.sendTime)),1)])),_:2},1024)])),_:2},1024),h(o,{class:"im-flex im-rows-reverse self im-align-items-end"},{default:f((()=>["text"==t.type?(g(),u(o,{key:0},{default:f((()=>[h(o,{class:"content shadow"},{default:f((()=>[h(B,{"container-style":"overflow: hidden;display:inline;white-space: pre-wrap",content:e.emojiToHtml(t.content)},null,8,["content"])])),_:2},1024),t.extends&&t.extends.content?(g(),u(o,{key:0,class:"message-quote radius-6"},{default:f((()=>[x(T(t.extends.content),1)])),_:2},1024)):b("",!0)])),_:2},1024)):"image"==t.type?(g(),y(w,{key:1},[t.extends&&t.extends.fixMode?(g(),y(w,{key:0},[t.extends.fixMode<=2?(g(),u(V,{key:0,src:t.content,class:"radius",mode:1==t.extends.fixMode?"widthFix":"heightFix",style:k(1==t.extends.fixMode?"width:200px":""),onClick:e.showImgs,"data-img":t.content},null,8,["src","mode","style","onClick","data-img"])):b("",!0),3==t.extends.fixMode?(g(),u(V,{key:1,src:t.content,class:"radius",mode:"scaleToFill",style:k([{width:t.extends.width+"px",height:t.extends.height+"px"}]),onClick:e.showImgs,"data-img":t.content},null,8,["src","style","onClick","data-img"])):b("",!0)],64)):(g(),u(V,{key:1,src:t.content,class:"radius",mode:"heightFix",onClick:e.showImgs,"data-img":t.content},null,8,["src","onClick","data-img"]))],64)):"voice"==t.type?(g(),u(o,{key:2,class:C(["im-voice-msg im-flex im-rows im-nowrap im-align-items-center radius-20",[s==e.playIndex?"linear-green":"",t.fromUser.id==i.user.user_id?"im-rows-reverse":""]]),"data-voice":t.content,"data-index":s,onClick:e.playVoice,style:k({width:3*t.extends.duration+"px"})},{default:f((()=>[h(c,{class:C(["f-16 cuIcon-subscription rotate45",[s==e.playIndex?"c-white":"",t.fromUser.id==i.user.user_id?"rotate225":""]])},null,8,["class"]),h(c,{class:C(["im-voice-msg-text",[s==e.playIndex?"c-white":""]])},{default:f((()=>[x(T(t.extends.duration)+' "',1)])),_:2},1032,["class"])])),_:2},1032,["class","data-voice","data-index","onClick","style"])):"video"==t.type?(g(),u(o,{key:3},{default:f((()=>[h(o,{class:"course-video radius-10",onClick:s=>e.handlePlay(t)},{default:f((()=>[h(o,{class:"relative-shadow"},{default:f((()=>[h(o,{class:"cuIcon-video icon-center f-28 c-white"})])),_:1}),t.extends?(g(),u(V,{key:0,src:t.extends.poster,class:"",mode:"heightFix"},null,8,["src"])):b("",!0)])),_:2},1032,["onClick"])])),_:2},1024)):"file"==t.type?(g(),u(o,{key:4},{default:f((()=>[h(o,{class:"file-card bg-white radius-10 im-flex im-justify-content-start pd-10 im-align-items-center",onClick:S((s=>e.previewFile(t)),["stop"])},{default:f((()=>[h(V,{src:t.extUrl,style:{width:"64rpx",height:"80rpx"}},null,8,["src"]),h(o,{class:"im-flex im-columns ml-10"},{default:f((()=>[h(o,{class:"text-overflow file-name"},{default:f((()=>[x(T(t.fileName),1)])),_:2},1024),h(o,{class:"text-gray file-size f-12"},{default:f((()=>[x(T(e.fileSize(t.fileSize)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)):"webrtc"==t.type?(g(),u(o,{key:5,class:C(["im-voice-msg im-flex im-rows im-nowrap im-align-items-center radius-20",[t.fromUser.id==i.user.user_id?"im-rows-reverse":""]])},{default:f((()=>[h(c,{class:C(["f-16",[1==t.extends.type?"cuIcon-record":"cuIcon-dianhua",t.fromUser.id==i.user.user_id?"rotate180":""]])},null,8,["class"]),h(c,{class:"im-voice-msg-text"},{default:f((()=>[x(T(t.content),1)])),_:2},1024)])),_:2},1032,["class"])):"location"==t.type?(g(),u(o,{key:6,onClick:s=>e.openLocation(t.extends),class:"im-location-msg im-flex im-rows im-nowrap im-align-items-center radius-8 pd-10"},{default:f((()=>[h(o,{class:"f-24 cuIcon-location pr-5"}),h(o,null,{default:f((()=>[h(o,{class:"f-14 mb-5"},{default:f((()=>[x(T(t.content),1)])),_:2},1024),h(o,{class:"c-999 f-12"},{default:f((()=>[x(T(t.extends&&t.extends.address),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])):"contact"==t.type?(g(),u(o,{key:7,onClick:s=>e.openContact(t.extends),class:"im-contact-msg radius-8 pt-10 pr-10 pl-10 pb-5"},{default:f((()=>[h(o,{class:"im-flex im-rows im-nowrap im-align-items-center"},{default:f((()=>[h(o,{class:"cu-avatar mr-10 radius",style:k([{backgroundImage:"url("+t.extends.avatar+")"}])},null,8,["style"]),h(o,{class:"c-333"},{default:f((()=>[x(T(t.extends.displayName),1)])),_:2},1024)])),_:2},1024),j("hr",{class:"mt-10 c-999"}),h(o,{class:"c-666 f-10"},{default:f((()=>[x(" 个人名片 ")])),_:1})])),_:2},1032,["onClick"])):(g(),u(q,{key:8,class:"other",item:t,index:s,isSelf:!0},null,8,["item","index"]))])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),i.messageList.length?b("",!0):(g(),u(D,{key:0,noDatatext:"暂无记录",textcolor:"#999"})),h(o,{class:"im-pagination"},{default:f((()=>[h(E,{total:i.dataTotal,pageSize:i.params.limit,onChange:l.changePage,title:"标题文字"},null,8,["total","pageSize","onChange"])])),_:1})])),_:1},8,["style"]),h(o,{class:C(["cu-modal bottom-modal","preview"==i.modelName?"show":""]),onClick:t[5]||(t[5]=e=>i.modelName="")},{default:f((()=>["preview"==i.modelName?(g(),u(o,{key:0,class:"cu-dialog"},{default:f((()=>[h(o,{class:"cu-list menu bg-white"},{default:f((()=>[h(o,{class:"cu-item",onClick:t[3]||(t[3]=t=>e.preview(1))},{default:f((()=>[h(o,{class:"content padding-tb-sm"},{default:f((()=>[h(c,{class:"text-center"},{default:f((()=>[x("本地预览(需下载)")])),_:1}),h(o,{class:"text-gray text-sm"},{default:f((()=>[x("需下载，仅支持office类型文件")])),_:1})])),_:1})])),_:1}),h(o,{class:"cu-item",onClick:t[4]||(t[4]=t=>e.preview(2))},{default:f((()=>[h(o,{class:"content padding-tb-sm"},{default:f((()=>[h(c,null,{default:f((()=>[x("在线预览")])),_:1}),h(o,{class:"text-gray text-sm"},{default:f((()=>[x("支持常用的文件和文档")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):b("",!0)])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-d5c0cea1"]]);export{D as default};
