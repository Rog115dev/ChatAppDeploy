import{_ as i,o as e,c as t,w as s,a as o,l as a,f as h,aa as r,m as d,g as l,T as n,M as c,G as u,a5 as m,x as g,z as p,v as f,C as b,r as j,b as k,F as _,e as w,t as C,d as L,j as y,X as x,W as E,i as v}from"./index-CDOpH1f_.js";import{r as B}from"./uni-app.es.DwBKReRU.js";const I=i({name:"UniGridItem",inject:["grid"],props:{index:{type:Number,default:0}},data:()=>({column:0,showBorder:!0,square:!0,highlight:!0,left:0,top:0,openNum:2,width:0,borderColor:"#e5e5e5"}),created(){this.column=this.grid.column,this.showBorder=this.grid.showBorder,this.square=this.grid.square,this.highlight=this.grid.highlight,this.top=0===this.hor?this.grid.hor:this.hor,this.left=0===this.ver?this.grid.ver:this.ver,this.borderColor=this.grid.borderColor,this.grid.children.push(this),this.width=this.grid.width},beforeDestroy(){this.grid.children.forEach(((i,e)=>{i===this&&this.grid.children.splice(e,1)}))},methods:{_onClick(){this.grid.change({detail:{index:this.index}})}}},[["render",function(i,n,c,u,m,g){const p=l;return m.width?(e(),t(p,{key:0,style:h("width:"+m.width+";"+(m.square?"height:"+m.width:"")),class:"uni-grid-item"},{default:s((()=>[o(p,{class:a([{"uni-grid-item--border":m.showBorder,"uni-grid-item--border-top":m.showBorder&&c.index<m.column,"uni-highlight":m.highlight},"uni-grid-item__box"]),style:h({"border-right-color":m.borderColor,"border-bottom-color":m.borderColor,"border-top-color":m.borderColor}),onClick:g._onClick},{default:s((()=>[r(i.$slots,"default",{},void 0,!0)])),_:3},8,["class","style","onClick"])])),_:3},8,["style"])):d("",!0)}],["__scopeId","data-v-2c119250"]]);const M=i({name:"UniGrid",emits:["change"],props:{column:{type:Number,default:3},showBorder:{type:Boolean,default:!0},borderColor:{type:String,default:"#D2D2D2"},square:{type:Boolean,default:!0},highlight:{type:Boolean,default:!0}},provide(){return{grid:this}},data:()=>({elId:`Uni_${Math.ceil(1e6*Math.random()).toString(36)}`,width:0}),created(){this.children=[]},mounted(){this.$nextTick((()=>{this.init()}))},methods:{init(){setTimeout((()=>{this._getSize((i=>{this.children.forEach(((e,t)=>{e.width=i}))}))}),50)},change(i){this.$emit("change",i)},_getSize(i){n().in(this).select(`#${this.elId}`).boundingClientRect().exec((e=>{this.width=parseInt((e[0].width-1)/this.column)+"px",i(this.width)}))}}},[["render",function(i,d,n,c,u,m){const g=l;return e(),t(g,{class:"uni-grid-wrap"},{default:s((()=>[o(g,{id:u.elId,ref:"uni-grid",class:a(["uni-grid",{"uni-grid--border":n.showBorder}]),style:h({"border-left-color":n.borderColor})},{default:s((()=>[r(i.$slots,"default",{},void 0,!0)])),_:3},8,["id","class","style"])])),_:3})}],["__scopeId","data-v-26adf091"]]);const $=i({data:()=>({emojiList:[],isManage:!1,manageName:"整理",checkList:[]}),onLoad(i){this.url=decodeURI(i.src),this.name=i.name},mounted(){this.getEmojiList()},methods:{getEmojiList(){this.$api.emojiApi.emojiList({}).then((i=>{0==i.code&&(this.emojiList=i.data)}))},uploadEmoji(){c({count:9,sizeType:["compressed"],sourceType:["album","camera"],success:i=>{i.tempFiles.forEach((i=>{if(i.size>2097152)return u({title:"表情大小不能超过2MB",icon:"error"});m({url:this.$api.emojiApi.uploadEmoji,filePath:i.path,name:"file",header:{Authorization:g("authToken")},success:i=>{0==JSON.parse(i.data).code&&this.updateEmoji()},fail:i=>{}})}))}})},manage(){this.isManage=!this.isManage,this.manageName=this.isManage?"取消":"整理",this.isManage||(this.checkList=[],this.emojiList.forEach(((i,e)=>{this.emojiList[e].isCheck=!1})))},change(i){let{index:e}=i.detail;if(!this.isManage||0==e)return;let t=this.emojiList[e-1].isCheck,s=this.emojiList[e-1].id;t?this.checkList=this.checkList.filter((i=>i!==s)):this.checkList.push(s),this.emojiList[e-1].isCheck=!t},moveEmoji(){this.checkList.length<=0||this.$api.emojiApi.moveEmoji({ids:this.checkList}).then((i=>{this.updateEmoji()}))},delEmoji(){this.checkList.length<=0||p({title:"确定要删除选中的表情吗？",success:i=>{i.confirm&&this.$api.emojiApi.delEmoji({ids:this.checkList}).then((i=>{this.updateEmoji()}))}})},updateEmoji(){this.getEmojiList(),this.checkList=[],f("updateEmoji",!0)}}},[["render",function(i,h,r,n,c,u){const m=l,g=b("cu-custom"),p=y,f=B(j("uni-grid-item"),I),$=v,z=B(j("uni-grid"),M),N=x,T=E;return e(),k(_,null,[o(g,{isBack:!0,bgColor:"bg-white"},{content:s((()=>[w("表情管理（"+C(c.emojiList.length)+"）",1)])),right:s((()=>[o(m,{class:"ml-10 mr-10",onClick:h[0]||(h[0]=i=>u.manage())},{default:s((()=>[w(C(c.manageName),1)])),_:1})])),_:1}),o(m,null,{default:s((()=>[o(N,{"scroll-y":"",class:"bg-white",style:{"padding-bottom":"100rpx"}},{default:s((()=>[o(z,{column:5,highlight:!0,onChange:u.change,style:{padding:"10rpx"}},{default:s((()=>[o(f,null,{default:s((()=>[o(m,{class:"grid-item-box",index:0},{default:s((()=>[o(m,{class:"upload-emoji",onClick:u.uploadEmoji},{default:s((()=>[o(p,{class:"cuIcon-add c-999",style:{"vertical-align":"sub"}})])),_:1},8,["onClick"])])),_:1})])),_:1}),(e(!0),k(_,null,L(c.emojiList,((i,h)=>(e(),t(f,{index:h+1,key:h},{default:s((()=>[o(m,{class:"grid-item-box"},{default:s((()=>[o($,{src:i.src,style:{width:"100rpx"},"fade-show":!1,mode:"widthFix","lazy-load":""},null,8,["src"]),c.isManage?(e(),t(m,{key:0,class:a(["emoji-check-box",i.isCheck?"text-green cuIcon-roundcheckfill":"cuIcon-round"])},null,8,["class"])):d("",!0)])),_:2},1024)])),_:2},1032,["index"])))),128))])),_:1},8,["onChange"])])),_:1}),c.checkList.length>0?(e(),t(m,{key:0,class:"btn-opt bg-white im-flex im-align-items-center im-space-between pd-10"},{default:s((()=>[o(T,{class:"cu-btn bg-green",onClick:h[1]||(h[1]=i=>u.moveEmoji())},{default:s((()=>[w("移动到最前面")])),_:1}),o(T,{class:"cu-btn bg-red",onClick:h[2]||(h[2]=i=>u.delEmoji())},{default:s((()=>[w("删除("+C(c.checkList.length)+")",1)])),_:1})])),_:1})):d("",!0)])),_:1})],64)}],["__scopeId","data-v-e0fef3f0"]]);export{$ as default};
