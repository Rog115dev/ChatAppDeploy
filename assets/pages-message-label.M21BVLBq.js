import{ar as e,_ as t,O as a,r as s,o as l,c as o,w as i,a as n,f as r,aa as c,e as u,t as h,m as d,g as p,ab as m,j as f,l as g,b as y,F as b,ae as C,u as x,s as S,n as _,G as w,z as k,C as v,a7 as $,d as V,X as F}from"./index-BWCeDMGH.js";import{_ as B}from"./uni-icons.V_6hCn98.js";import{r as I}from"./uni-app.es.BSjB11UY.js";import{_ as T}from"./uni-popup-dialog.CMMb0xud.js";import{_ as M}from"./uni-popup.B0pKJk65.js";const z={en:{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"Search enter content"},"zh-Hans":{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"请输入搜索内容"},"zh-Hant":{"uni-search-bar.cancel":"cancel","uni-search-bar.placeholder":"請輸入搜索內容"}},{t:L}=e(z);const N=t({name:"UniSearchBar",emits:["input","update:modelValue","clear","cancel","confirm","blur","focus"],props:{placeholder:{type:String,default:""},radius:{type:[Number,String],default:5},clearButton:{type:String,default:"auto"},cancelButton:{type:String,default:"auto"},cancelText:{type:String,default:"取消"},bgColor:{type:String,default:"#F8F8F8"},maxlength:{type:[Number,String],default:100},value:{type:[Number,String],default:""},modelValue:{type:[Number,String],default:""},focus:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},data:()=>({show:!1,showSync:!1,searchVal:""}),computed:{cancelTextI18n(){return this.cancelText||L("uni-search-bar.cancel")},placeholderText(){return this.placeholder||L("uni-search-bar.placeholder")}},watch:{modelValue:{immediate:!0,handler(e){this.searchVal=e,e&&(this.show=!0)}},focus:{immediate:!0,handler(e){if(e){if(this.readonly)return;this.show=!0,this.$nextTick((()=>{this.showSync=!0}))}}},searchVal(e,t){this.$emit("input",e),this.$emit("update:modelValue",e)}},methods:{searchClick(){this.readonly||this.show||(this.show=!0,this.$nextTick((()=>{this.showSync=!0})))},clear(){this.$emit("clear",{value:this.searchVal}),this.searchVal=""},cancel(){this.readonly||(this.$emit("cancel",{value:this.searchVal}),this.searchVal="",this.show=!1,this.showSync=!1,a())},confirm(){a(),this.$emit("confirm",{value:this.searchVal})},blur(){a(),this.$emit("blur",{value:this.searchVal})},emitFocus(e){this.$emit("focus",e.detail)}}},[["render",function(e,t,a,g,y,b){const C=I(s("uni-icons"),B),x=p,S=m,_=f;return l(),o(x,{class:"uni-searchbar"},{default:i((()=>[n(x,{style:r({borderRadius:a.radius+"px",backgroundColor:a.bgColor}),class:"uni-searchbar__box",onClick:b.searchClick},{default:i((()=>[n(x,{class:"uni-searchbar__box-icon-search"},{default:i((()=>[c(e.$slots,"searchIcon",{},(()=>[n(C,{color:"#c0c4cc",size:"18",type:"search"})]),!0)])),_:3}),y.show||y.searchVal?(l(),o(S,{key:0,focus:y.showSync,disabled:a.readonly,placeholder:b.placeholderText,maxlength:a.maxlength,class:"uni-searchbar__box-search-input","confirm-type":"search",type:"text",modelValue:y.searchVal,"onUpdate:modelValue":t[0]||(t[0]=e=>y.searchVal=e),onConfirm:b.confirm,onBlur:b.blur,onFocus:b.emitFocus},null,8,["focus","disabled","placeholder","maxlength","modelValue","onConfirm","onBlur","onFocus"])):(l(),o(_,{key:1,class:"uni-searchbar__text-placeholder"},{default:i((()=>[u(h(a.placeholder),1)])),_:1})),y.show&&("always"===a.clearButton||"auto"===a.clearButton&&""!==y.searchVal)&&!a.readonly?(l(),o(x,{key:2,class:"uni-searchbar__box-icon-clear",onClick:b.clear},{default:i((()=>[c(e.$slots,"clearIcon",{},(()=>[n(C,{color:"#c0c4cc",size:"20",type:"clear"})]),!0)])),_:3},8,["onClick"])):d("",!0)])),_:3},8,["style","onClick"]),"always"===a.cancelButton||y.show&&"auto"===a.cancelButton?(l(),o(_,{key:0,onClick:b.cancel,class:"uni-searchbar__cancel"},{default:i((()=>[u(h(b.cancelTextI18n),1)])),_:1},8,["onClick"])):d("",!0)])),_:3})}],["__scopeId","data-v-03210105"]]);function P(e){let t="";for(let a in e){t+=`${a}:${e[a]};`}return t}const j=t({name:"uni-easyinput",emits:["click","iconClick","update:modelValue","input","focus","blur","confirm","clear","eyes","change"],model:{prop:"modelValue",event:"update:modelValue"},options:{virtualHost:!0},inject:{form:{from:"uniForm",default:null},formItem:{from:"uniFormItem",default:null}},props:{name:String,value:[Number,String],modelValue:[Number,String],type:{type:String,default:"text"},clearable:{type:Boolean,default:!0},autoHeight:{type:Boolean,default:!1},placeholder:{type:String,default:" "},placeholderStyle:String,focus:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},maxlength:{type:[Number,String],default:140},confirmType:{type:String,default:"done"},clearSize:{type:[Number,String],default:24},inputBorder:{type:Boolean,default:!0},prefixIcon:{type:String,default:""},suffixIcon:{type:String,default:""},trim:{type:[Boolean,String],default:!0},passwordIcon:{type:Boolean,default:!0},styles:{type:Object,default:()=>({color:"#333",disableColor:"#F7F6F6",borderColor:"#e5e5e5"})},errorMessage:{type:[String,Boolean],default:""}},data:()=>({focused:!1,val:"",showMsg:"",border:!1,isFirstBorder:!1,showClearIcon:!1,showPassword:!1,focusShow:!1,localMsg:""}),computed:{isVal(){const e=this.val;return!(!e&&0!==e)},msg(){return this.localMsg||this.errorMessage},inputMaxlength(){return Number(this.maxlength)},boxStyle(){return`color:${this.inputBorder&&this.msg?"#e43d33":this.styles.color};`},inputContentClass(){return function(e){let t="";for(let a in e)e[a]&&(t+=`${a} `);return t}({"is-input-border":this.inputBorder,"is-input-error-border":this.inputBorder&&this.msg,"is-textarea":"textarea"===this.type,"is-disabled":this.disabled})},inputContentStyle(){const e=this.focusShow?"#2979ff":this.styles.borderColor;return P({"border-color":(this.inputBorder&&this.msg?"#dd524d":e)||"#e5e5e5","background-color":this.disabled?this.styles.disableColor:"#fff"})},inputStyle(){return P({"padding-right":"password"===this.type||this.clearable||this.prefixIcon?"":"10px","padding-left":this.prefixIcon?"":"10px"})}},watch:{value(e){this.val=e},modelValue(e){this.val=e},focus(e){this.$nextTick((()=>{this.focused=this.focus,this.focusShow=this.focus}))}},created(){this.init(),this.form&&this.formItem&&this.$watch("formItem.errMsg",(e=>{this.localMsg=e}))},mounted(){this.$nextTick((()=>{this.focused=this.focus,this.focusShow=this.focus}))},methods:{init(){this.value||0===this.value?this.val=this.value:this.modelValue||0===this.modelValue?this.val=this.modelValue:this.val=null},onClickIcon(e){this.$emit("iconClick",e)},onEyes(){this.showPassword=!this.showPassword,this.$emit("eyes",this.showPassword)},onInput(e){let t=e.detail.value;this.trim&&("boolean"==typeof this.trim&&this.trim&&(t=this.trimStr(t)),"string"==typeof this.trim&&(t=this.trimStr(t,this.trim))),this.errMsg&&(this.errMsg=""),this.val=t,this.$emit("input",t),this.$emit("update:modelValue",t)},onFocus(){this.$nextTick((()=>{this.focused=!0})),this.$emit("focus",null)},_Focus(e){this.focusShow=!0,this.$emit("focus",e)},onBlur(){this.focused=!1,this.$emit("focus",null)},_Blur(e){if(e.detail.value,this.focusShow=!1,this.$emit("blur",e),this.$emit("change",this.val),this.form&&this.formItem){const{validateTrigger:e}=this.form;"blur"===e&&this.formItem.onFieldChange()}},onConfirm(e){this.$emit("confirm",this.val),this.$emit("change",this.val)},onClear(e){this.val="",this.$emit("input",""),this.$emit("update:modelValue",""),this.$emit("clear")},trimStr:(e,t="both")=>"both"===t?e.trim():"left"===t?e.trimLeft():"right"===t?e.trimRight():"start"===t?e.trimStart():"end"===t?e.trimEnd():"all"===t?e.replace(/\s+/g,""):e}},[["render",function(e,t,a,u,h,f){const x=I(s("uni-icons"),B),S=C,_=m,w=p;return l(),o(w,{class:g(["uni-easyinput",{"uni-easyinput-error":f.msg}]),style:r(f.boxStyle)},{default:i((()=>[n(w,{class:g(["uni-easyinput__content",f.inputContentClass]),style:r(f.inputContentStyle)},{default:i((()=>[a.prefixIcon?(l(),o(x,{key:0,class:"content-clear-icon",type:a.prefixIcon,color:"#c0c4cc",onClick:t[0]||(t[0]=e=>f.onClickIcon("prefix")),size:"22"},null,8,["type"])):d("",!0),"textarea"===a.type?(l(),o(S,{key:1,class:g(["uni-easyinput__content-textarea",{"input-padding":a.inputBorder}]),name:a.name,value:h.val,placeholder:a.placeholder,placeholderStyle:a.placeholderStyle,disabled:a.disabled,"placeholder-class":"uni-easyinput__placeholder-class",maxlength:f.inputMaxlength,focus:h.focused,autoHeight:a.autoHeight,onInput:f.onInput,onBlur:f._Blur,onFocus:f._Focus,onConfirm:f.onConfirm},null,8,["class","name","value","placeholder","placeholderStyle","disabled","maxlength","focus","autoHeight","onInput","onBlur","onFocus","onConfirm"])):(l(),o(_,{key:2,type:"password"===a.type?"text":a.type,class:"uni-easyinput__content-input",style:r(f.inputStyle),name:a.name,value:h.val,password:!h.showPassword&&"password"===a.type,placeholder:a.placeholder,placeholderStyle:a.placeholderStyle,"placeholder-class":"uni-easyinput__placeholder-class",disabled:a.disabled,maxlength:f.inputMaxlength,focus:h.focused,confirmType:a.confirmType,onFocus:f._Focus,onBlur:f._Blur,onInput:f.onInput,onConfirm:f.onConfirm},null,8,["type","style","name","value","password","placeholder","placeholderStyle","disabled","maxlength","focus","confirmType","onFocus","onBlur","onInput","onConfirm"])),"password"===a.type&&a.passwordIcon?(l(),y(b,{key:3},[f.isVal?(l(),o(x,{key:0,class:g(["content-clear-icon",{"is-textarea-icon":"textarea"===a.type}]),type:h.showPassword?"eye-slash-filled":"eye-filled",size:22,color:h.focusShow?"#2979ff":"#c0c4cc",onClick:f.onEyes},null,8,["class","type","color","onClick"])):d("",!0)],64)):a.suffixIcon?(l(),y(b,{key:4},[a.suffixIcon?(l(),o(x,{key:0,class:"content-clear-icon",type:a.suffixIcon,color:"#c0c4cc",onClick:t[1]||(t[1]=e=>f.onClickIcon("suffix")),size:"22"},null,8,["type"])):d("",!0)],64)):(l(),y(b,{key:5},[a.clearable&&f.isVal&&!a.disabled&&"textarea"!==a.type?(l(),o(x,{key:0,class:g(["content-clear-icon",{"is-textarea-icon":"textarea"===a.type}]),type:"clear",size:a.clearSize,color:f.msg?"#dd524d":h.focusShow?"#2979ff":"#c0c4cc",onClick:f.onClear},null,8,["class","size","color","onClick"])):d("",!0)],64)),c(e.$slots,"right",{},void 0,!0)])),_:3},8,["class","style"])])),_:3},8,["class","style"])}],["__scopeId","data-v-0d2cc14d"]]),D=x(S);const H=t({data:()=>({searchText:"",tagForm:{name:""},tags:[],dialogType:"info",dialogTitle:"",countMap:{}}),computed:{filteredTags(){return this.searchText?this.tags.filter((e=>e.name.toLowerCase().includes(this.searchText.toLowerCase()))):this.tags}},onShow(){this.setCountMap(),this.getLabels()},methods:{setCountMap(){this.countMap={};let e=D.getContact();for(var t=0;t<e.length;t++){var a=e[t];if(a.tags)for(var s=0;s<a.tags.length;s++){var l=a.tags[s];this.countMap[l]||(this.countMap[l]=0),this.countMap[l]++}}},getLabels(){this.$api.msgApi.getLabels().then((e=>{0==e.code&&(this.tags=e.data.map((e=>(this.countMap[e.id]?e.count=this.countMap[e.id]:e.count=0,e))))}))},handleSearch(){},handleClear(){this.searchText=""},handleCreate(){this.dialogTitle="新建标签",this.tagForm.name="",this.tagForm.id="",this.$refs.tagPopup.open()},handleEdit(e){this.dialogTitle="编辑标签",this.tagForm.name=e.name,this.tagForm.id=e.id,this.$refs.tagPopup.open()},handleDialogClose(){this.$refs.tagPopup.close()},toLuser(e){_({url:"/pages/message/luser?name="+e.name+"&count="+e.count+"&id="+e.id})},handleDialogConfirm(){this.tagForm.name=this.tagForm.name.trim(),this.tagForm.name?this.$api.msgApi.updateLabel(this.tagForm).then((e=>{0==e.code&&(this.tagForm.id?this.tags=this.tags.map((e=>(e.id==this.tagForm.id&&(e.name=this.tagForm.name),e))):this.tags.push({id:e.data.id,name:this.tagForm.name,count:0}),this.handleDialogClose())})):w({title:"标签名称不能为空",icon:"none"})},handleDelete(e){k({title:"删除标签",content:`确定要删除"${e.name}"标签吗？`,success:t=>{t.confirm&&this.$api.msgApi.deleteLabel({id:e.id}).then((t=>{0==t.code&&(this.tags=this.tags.filter((t=>t.id!==e.id)),w({title:"删除成功",icon:"success"}))}))}})}}},[["render",function(e,t,a,r,c,d){const m=f,g=v("cu-custom"),C=I(s("uni-search-bar"),N),x=p,S=I(s("uni-icons"),B),_=F,w=I(s("uni-easyinput"),j),k=I(s("uni-popup-dialog"),T),z=I(s("uni-popup"),M);return l(),o(x,{class:"container"},{default:i((()=>[n(g,{bgColor:"bg-video",isBack:!0},{backText:i((()=>[])),content:i((()=>[n(m,{class:"pageNameS"},{default:i((()=>[u("标签")])),_:1})])),_:1}),n(x,{class:"search-box"},{default:i((()=>[n(C,{modelValue:c.searchText,"onUpdate:modelValue":t[0]||(t[0]=e=>c.searchText=e),placeholder:"搜索标签",onConfirm:d.handleSearch,onClear:d.handleClear,cancelButton:"none"},null,8,["modelValue","onConfirm","onClear"])])),_:1}),n(_,{class:"tag-list","scroll-y":""},{default:i((()=>[0===d.filteredTags.length?(l(),o(x,{key:0,class:"empty-tips"},{default:i((()=>[$("uni-text",null,"暂无标签")])),_:1})):(l(),o(x,{key:1,class:"tag-items"},{default:i((()=>[(l(!0),y(b,null,V(d.filteredTags,((e,t)=>(l(),o(x,{key:t,class:"tag-item",onClick:t=>d.toLuser(e)},{default:i((()=>[n(x,{class:"tag-content"},{default:i((()=>[$("uni-text",{class:"tag-name"},h(e.name),1),$("uni-text",{class:"tag-count"},h(e.count)+"个好友",1)])),_:2},1024),n(x,{class:"tag-actions"},{default:i((()=>[n(S,{type:"compose",size:"20",color:"#fff",onClick:t=>d.handleEdit(e)},null,8,["onClick"]),n(S,{type:"trash",size:"20",color:"#fff",onClick:t=>d.handleDelete(e)},null,8,["onClick"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}))])),_:1}),n(x,{class:"bottom-bar"},{default:i((()=>[$("uni-button",{type:"primary",onClick:t[1]||(t[1]=(...e)=>d.handleCreate&&d.handleCreate(...e))},"新建标签")])),_:1}),n(z,{ref:"tagPopup",type:"dialog"},{default:i((()=>[n(k,{type:c.dialogType,title:c.dialogTitle,"before-close":!0,onClose:d.handleDialogClose,onConfirm:d.handleDialogConfirm},{default:i((()=>[n(x,{class:"dialog-content"},{default:i((()=>[n(w,{modelValue:c.tagForm.name,"onUpdate:modelValue":t[2]||(t[2]=e=>c.tagForm.name=e),placeholder:"请输入标签名称"},null,8,["modelValue"])])),_:1})])),_:1},8,["type","title","onClose","onConfirm"])])),_:1},512)])),_:1})}],["__scopeId","data-v-8a5f2355"]]);export{H as default};
