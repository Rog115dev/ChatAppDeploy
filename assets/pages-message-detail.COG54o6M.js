import{_ as t,o as e,c as s,w as a,a as i,l as c,aa as l,f as n,e as o,t as u,m as d,g as r,j as p,q as g,s as h,u as _,G as f,Z as m,n as y,z as v,C as k,r as C,b as x,d as b,F as A,ad as I,ac as N,ae as $,af as S,i as w,ag as U}from"./index-nIaQZq1w.js";import{_ as L}from"./uni-popup-dialog.Ezo92SfF.js";import{r as M}from"./uni-app.es.CqmdVAE5.js";import{_ as P}from"./uni-popup.DhfXoNXr.js";const T=t({name:"UniSection",emits:["click"],props:{type:{type:String,default:""},title:{type:String,required:!0,default:""},titleFontSize:{type:String,default:"14px"},titleColor:{type:String,default:"#333"},subTitle:{type:String,default:""},subTitleFontSize:{type:String,default:"12px"},subTitleColor:{type:String,default:"#999"},padding:{type:[Boolean,String],default:!1}},computed:{_padding(){return"string"==typeof this.padding?this.padding:this.padding?"10px":""}},watch:{title(t){uni.report&&""!==t&&uni.report("title",t)}},methods:{onClick(){this.$emit("click")}}},[["render",function(t,g,h,_,f,m){const y=r,v=p;return e(),s(y,{class:"uni-section"},{default:a((()=>[i(y,{class:"uni-section-header",onClick:m.onClick},{default:a((()=>[h.type?(e(),s(y,{key:0,class:c(["uni-section-header__decoration",h.type])},null,8,["class"])):l(t.$slots,"decoration",{key:1},void 0,!0),i(y,{class:"uni-section-header__content"},{default:a((()=>[i(v,{style:n({"font-size":h.titleFontSize,color:h.titleColor}),class:c(["uni-section__content-title",{distraction:!h.subTitle}])},{default:a((()=>[o(u(h.title),1)])),_:1},8,["style","class"]),h.subTitle?(e(),s(v,{key:0,style:n({"font-size":h.subTitleFontSize,color:h.subTitleColor}),class:"uni-section-header__content-sub"},{default:a((()=>[o(u(h.subTitle),1)])),_:1},8,["style"])):d("",!0)])),_:1}),i(y,{class:"uni-section-header__slot-right"},{default:a((()=>[l(t.$slots,"right",{},void 0,!0)])),_:3})])),_:3},8,["onClick"]),i(y,{class:"uni-section-content",style:n({padding:m._padding})},{default:a((()=>[l(t.$slots,"default",{},void 0,!0)])),_:3},8,["style"])])),_:3})}],["__scopeId","data-v-0a8818d5"]]),j=g(h),G=_(h);const V=t({components:{},data:()=>({pageLoading:!0,contact_id:null,is_group:0,groupUserCount:0,modelName:!1,userList:[],allUser:[],userInfo:j.userInfo,chatRecordlist:[{text:"文本",icon:"icon-wenben",type:"text"},{text:"图片",icon:"icon-zhaopian",type:"image"},{text:"文件",icon:"icon-wenjian",type:"file"},{text:"视频",icon:"icon-shipin",type:"video"},{text:"项目",icon:"icon-xiangmu_2",type:"project"},{text:"客户",icon:"icon-kehu",type:"leads"}],radioList:[{label:"关闭",value:0},{label:"仅管理员可发言",value:1},{label:"仅群主可发言",value:2}],isAuth:!1,contact:null,isAdmin:!1,isManage:!1,user_ids:[],user:[]}),onShow(){this.getUserlist()},onLoad:async function(t){this.is_group=t.is_group,this.contact_id=t.id;let e=await this.$api.msgApi.initContacts();G.sysUnread=e.count,G.initContacts(JSON.parse(JSON.stringify(e)).data);let s=G.getContact(this.contact_id);s?(this.contact=s,0==this.is_group&&(s.userInfo={id:s.user_id,account:s.account,displayName:s.displayName,avatar:s.avatar},this.allUser.push(s),this.userList.push(s))):f({title:"联系人不存在",icon:"none",duration:1500,complete:t=>{m({url:"/pages/index/index"})}})},methods:{initContacts(){this.modelName="",this.$api.msgApi.initContacts().then((t=>{G.sysUnread=t.count,G.initContacts(JSON.parse(JSON.stringify(t)).data)}))},users(){(this.isAuth||1!=this.contact.is_private)&&y({url:`/pages/message/group/groupUser?group_id=${this.contact_id}`})},uploadAvatar(t){y({url:"/pages/message/uploadGroupAvatar/uploadGroupAvatar?group_id="+this.contact.group_id+"&avatar="+this.contact.avatar})},openModel(t){this.modelName=t},closeModel(){this.modelName=!1},saveManage(){this.isAuth&&(this.$api.msgApi.groupSetting({id:this.contact.id,setting:this.contact.setting}),this.modelName=!1)},setManage(t){this.contact.setting.manage=t.detail.value?"1":"0"},setInvite(t){this.contact.setting.invite=t.detail.value?"1":"0"},setHistory(t){this.contact.setting.history=t.detail.value?"1":"0"},setProfile(t){this.contact.setting.profile=t.detail.value?"1":"0"},setSpeak(t){this.contact.setting.nospeak=t.detail.value},setIsPrivate(t){this.contact.is_private=t.detail.value?1:0,this.$api.msgApi.isPrivateAPI({id:this.contact.id,is_group:this.contact.is_group,is_private:this.contact.is_private})},setIsNotice(t){this.contact.is_notice=t.detail.value?0:1,this.$api.msgApi.isNoticeAPI({id:this.contact.id,is_group:this.contact.is_group,is_notice:this.contact.is_notice})},setIsTop(t){this.contact.is_top=t.detail.value?1:0,this.$api.msgApi.setChatTopAPI({id:this.contact.id,is_group:this.contact.is_group,is_top:this.contact.is_top})},editNotice(){this.isAuth&&(this.$api.msgApi.setNotice({id:this.contact.id,notice:this.contact.notice}),this.modelName=!1)},open(){this.$refs.popup.open()},openVirtual(){this.$refs.virtual.open()},openQr(){y({url:"/pages/index/qrcode?group_id="+this.contact.id})},editGroupName(t){this.$api.msgApi.editGroupName({id:this.contact.id,displayName:t}).then((e=>{this.contact.displayName=t,this.$refs.popup.close()}))},editVirtualCount(t){this.$api.msgApi.editVirtualCount({id:this.contact.id,virtual_count:t}).then((e=>{this.contact.virtual_count=t,this.$refs.virtual.close()}))},closePop(){this.$refs.popup.close()},closeVirtualPop(){this.$refs.virtual.close()},removeGroup(){let t="退出群聊";this.isAdmin&&(t="解散群聊"),v({title:"确定要"+t+"吗?",success:t=>{t.confirm&&(this.isAdmin?this.$api.msgApi.removeGroup({id:this.contact.id}).then((t=>{m({url:"/pages/index/index"})})):this.$api.msgApi.removeUser({id:this.contact.id,user_id:this.userInfo.user_id}).then((t=>{m({url:"/pages/index/index"})})))}})},clearMessage(){this.isAdmin||f({title:"无权操作",icon:"none"}),v({title:"清除后该群所有人的记录都会被删除，确定继续吗?",success:t=>{t.confirm&&this.$api.msgApi.clearMessage({id:this.contact.id}).then((t=>{f({title:"清除成功",icon:"none"})}))}})},editUser(t){this.user_ids=this.allUser.map((t=>t.user_id)),0==this.contact.is_group&&(t=1),y({url:"/pages/index/userSelection?type="+t+"&contact_id="+this.contact.id})},manageUser(){y({url:"/pages/message/group/groupUser?group_id="+this.contact.id})},setAvatar(){y({url:"/pages/mine/avatar"})},goChatRecord(t){y({url:"/package/message/pages/chatRecord/chatRecord?type="+t+"&toContactId="+this.contact_id+"&is_group=1"})},getUserlist(){0!=this.is_group&&(this.userList=[],this.$api.msgApi.groupUserList({group_id:this.contact_id,limit:20}).then((t=>{if(this.user=t.data,0!==t.code)return;const e=t.data.filter((t=>1==t.role&&t.userInfo.id==this.userInfo.user_id));e.length&&(this.isAdmin=!0);const s=t.data.filter((t=>2==t.role&&t.userInfo.id==this.userInfo.user_id));s.length&&(this.manage=!0),(e.length||s.length)&&(this.isAuth=!0),this.allUser=JSON.parse(JSON.stringify(t.data)),t.data.length>18?this.isAuth?this.userList=t.data.splice(0,18):this.contact.setting.invite?this.userList=t.data.splice(0,19):this.userList=t.data.splice(0,20):this.userList=t.data,this.groupUserCount=t.count,this.pageLoading=!1})))},openChatDetail(t){if(this.userInfo.user_id==t.id||!this.isAuth&&this.contact.is_private)return;let e=G.getContact(t.id);if(!(this.contact.role<3||"1"==this.contact.setting.profile||e))return f({title:"已开启用户隐私！",icon:"none"}),!1;y({url:"/pages/contacts/detail?id="+t.id})}}},[["render",function(t,l,g,h,_,f){const m=k("cu-custom"),y=w,v=r,j=p,G=M(C("uni-popup-dialog"),L),V=M(C("uni-popup"),P),z=I,J=N,O=$,F=U,q=S,R=M(C("uni-section"),T);return e(),s(v,null,{default:a((()=>[i(m,{bgColor:"bg-video",isBack:!0},{backText:a((()=>[])),content:a((()=>[o("聊天信息")])),_:1}),_.contact?(e(),s(v,{key:0,style:n([{height:`calc(${t.safeHeight}px - 45px)`},{"overflow-y":"auto"}])},{default:a((()=>[i(v,{class:"bg-video"},{default:a((()=>[i(v,{class:"user-list im-flex im-justify-content-start im-align-items-center im-a im-wrap"},{default:a((()=>[(e(!0),x(A,null,b(_.userList,((t,c)=>(e(),x(A,{key:c},[0==_.contact.is_private||c<5?(e(),s(v,{key:0,class:"user-info mt-20",align:"center"},{default:a((()=>[i(y,{class:"user-avatar",src:t.userInfo.avatar,onClick:e=>f.openChatDetail(t.userInfo)},null,8,["src","onClick"]),i(v,{class:"text-center user-name text-overflow"},{default:a((()=>[o(u(t.userInfo.displayName),1)])),_:2},1024)])),_:2},1024)):d("",!0)],64)))),128)),_.isAuth||0==_.is_group||_.contact.setting.invite?(e(),s(v,{key:0,class:"user-info mt-20"},{default:a((()=>[i(v,{class:"user-opt radius-8",style:{margin:"auto"},onClick:l[0]||(l[0]=t=>f.editUser(2))},{default:a((()=>[i(v,{class:"icon cuIcon-add f-24"})])),_:1}),i(v,{class:"f-11 mt-5"},{default:a((()=>[o("添加成员")])),_:1})])),_:1})):d("",!0),_.isAuth?(e(),s(v,{key:1,class:"user-info mt-20"},{default:a((()=>[i(v,{class:"user-opt radius-8",style:{margin:"auto"},onClick:l[1]||(l[1]=t=>f.manageUser())},{default:a((()=>[i(v,{class:"icon cuIcon-move f-24"})])),_:1}),i(v,{class:"f-11 mt-5"},{default:a((()=>[o("移除成员")])),_:1})])),_:1})):d("",!0)])),_:1}),1==_.is_group?(e(),s(v,{key:0,class:"mt-10",onClick:f.users},{default:a((()=>[0==_.contact.is_private?(e(),s(v,{key:0,class:"text-center pb-15 pt-15 im-flex im-justify-content-center im-align-items-center"},{default:a((()=>[i(j,{class:"gui-list-title-text gui-list-one-line gui-primary-color"},{default:a((()=>[o("查看全部群成员")])),_:1}),i(j,{class:"gui-list-title-desc gui-color-gray"},{default:a((()=>[o(u(_.groupUserCount+(_.contact.virtual_count?parseInt(_.contact.virtual_count):0))+"人",1)])),_:1}),i(j,{class:"cuIcon-right"})])),_:1})):(e(),s(v,{key:1,class:"text-center pb-15 pt-15 im-flex im-justify-content-center im-align-items-center"},{default:a((()=>[i(j,{class:"gui-list-title-text gui-list-one-line gui-primary-color",style:{color:"red"}},{default:a((()=>[o("开启了群隐私，最多显示5人")])),_:1})])),_:1}))])),_:1},8,["onClick"])):d("",!0)])),_:1}),1==_.is_group?(e(),s(v,{key:0,class:"cu-list menu mt-15 bg-video"},{default:a((()=>[i(v,{class:"cu-item",onClick:f.open},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o(" 群聊名称 ")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(v,{class:"text-grey"},{default:a((()=>[o(u(_.contact.displayName)+" ",1),i(j,{class:"cuIcon-right"})])),_:1})])),_:1})])),_:1},8,["onClick"]),_.isAuth&&_.is_group?(e(),s(v,{key:0,class:"cu-item",onClick:f.uploadAvatar},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o(" 修改群头像 ")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(v,{class:"text-grey"},{default:a((()=>[i(j,{class:"cuIcon-right"})])),_:1})])),_:1})])),_:1},8,["onClick"])):d("",!0),_.contact.setting.invite?(e(),s(v,{key:1,class:"cu-item",onClick:f.openQr},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o(" 群二维码 ")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(v,{class:"text-grey"},{default:a((()=>[i(j,{class:"cuIcon-qr_code f-18"}),o(),i(j,{class:"cuIcon-right"})])),_:1})])),_:1})])),_:1},8,["onClick"])):d("",!0),i(v,{class:"cu-item",onClick:l[2]||(l[2]=t=>f.openModel("notice"))},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o(" 群公告 ")])),_:1})])),_:1}),i(v,{class:"action",style:{width:"80%"}},{default:a((()=>[i(v,{class:"text-grey im-flex im-justify-content-end"},{default:a((()=>[i(v,{class:"text-overflow notice-line"},{default:a((()=>[o(u(_.contact.notice??"暂无公告"),1)])),_:1}),i(j,{class:"cuIcon-right"})])),_:1})])),_:1})])),_:1}),_.isAuth?(e(),s(v,{key:2,class:"cu-item",onClick:l[3]||(l[3]=t=>f.openModel("manage"))},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o(" 群管理 ")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(v,{class:"text-grey"},{default:a((()=>[i(j,{class:"cuIcon-right"})])),_:1})])),_:1})])),_:1})):d("",!0),i(V,{ref:"popup",type:"dialog"},{default:a((()=>[i(G,{mode:"input",value:_.contact.displayName,title:"修改群名称",duration:2e3,"before-close":!0,onClose:f.closePop,onConfirm:f.editGroupName},null,8,["value","onClose","onConfirm"])])),_:1},512)])),_:1})):d("",!0),1==_.is_group&&_.isAuth?(e(),s(v,{key:1,class:"cu-list menu mt-15 bg-video"},{default:a((()=>[i(v,{class:"cu-item"},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o("成员隐私")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(z,{class:c(["switch",_.contact.is_private?"checked":""]),onChange:f.setIsPrivate,checked:!!_.contact.is_private},null,8,["onChange","class","checked"])])),_:1})])),_:1}),i(V,{ref:"virtual",type:"dialog"},{default:a((()=>[i(G,{mode:"input",value:_.contact.virtual_count,title:"修改虚拟人数",duration:2e3,"before-close":!0,onClose:f.closeVirtualPop,onConfirm:f.editVirtualCount},null,8,["value","onClose","onConfirm"])])),_:1},512)])),_:1})):d("",!0),i(v,{class:"cu-list menu mt-15 bg-video"},{default:a((()=>[i(v,{class:"cu-item"},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o(" 消息免打扰 ")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(z,{class:c(["switch",_.contact.is_notice?"":"checked"]),onChange:f.setIsNotice,checked:!_.contact.is_notice},null,8,["onChange","class","checked"])])),_:1})])),_:1}),i(v,{class:"cu-item"},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o(" 置顶聊天 ")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(z,{class:c(["switch",_.contact.is_top?"checked":""]),onChange:f.setIsTop,checked:!!_.contact.is_top},null,8,["onChange","class","checked"])])),_:1})])),_:1})])),_:1}),i(J,{class:"mt-10",url:`/pages/message/record?id=${_.contact_id}`},{default:a((()=>[i(v,{class:"cu-list menu mt-15 bg-video"},{default:a((()=>[i(v,{class:"cu-item"},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o(" 查看聊天记录 ")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(v,{class:"text-grey"},{default:a((()=>[i(j,{class:"cuIcon-right"})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["url"]),1==_.is_group&&_.isAdmin?(e(),s(v,{key:2,class:"cu-list menu mt-15 bg-video",onClick:f.clearMessage},{default:a((()=>[i(v,{class:"cu-item text-center delete-btn"},{default:a((()=>[i(j,{class:"c-orange"},{default:a((()=>[o("清空聊天记录")])),_:1})])),_:1})])),_:1},8,["onClick"])):d("",!0),1==_.is_group?(e(),s(v,{key:3,class:"cu-list menu mt-15 bg-video",onClick:f.removeGroup},{default:a((()=>[i(v,{class:"cu-item text-center delete-btn"},{default:a((()=>[i(j,{class:"c-red"},{default:a((()=>[o(u(_.isAdmin?"解散群聊":"退出群聊"),1)])),_:1})])),_:1})])),_:1},8,["onClick"])):d("",!0),i(v,{class:"parting-line-20"}),i(v,{class:c(["cu-modal bottom-modal","notice"==_.modelName?"show":""])},{default:a((()=>[i(v,{class:"cu-dialog"},{default:a((()=>[i(v,{class:"cu-bar bg-white"},{default:a((()=>[i(v,{class:"action text-gray",onClick:f.closeModel},{default:a((()=>[o("取消")])),_:1},8,["onClick"]),i(v,{class:"action text-green",onClick:f.editNotice},{default:a((()=>[o("保存")])),_:1},8,["onClick"])])),_:1}),i(v,{class:"notice-content"},{default:a((()=>[i(O,{class:"im-textarea",maxlength:"-1",disabled:!_.isAuth,modelValue:_.contact.notice,"onUpdate:modelValue":l[4]||(l[4]=t=>_.contact.notice=t),placeholder:"请输入公告内容..."},null,8,["disabled","modelValue"])])),_:1})])),_:1})])),_:1},8,["class"]),i(v,{class:c(["cu-modal bottom-modal","manage"==_.modelName?"show":""])},{default:a((()=>[i(v,{class:"cu-dialog"},{default:a((()=>[i(v,{class:"cu-bar bg-white"},{default:a((()=>[i(v,{class:"action text-gray",onClick:f.closeModel},{default:a((()=>[o("取消")])),_:1},8,["onClick"]),i(v,{class:"action text-green",onClick:f.saveManage},{default:a((()=>[o("保存")])),_:1},8,["onClick"])])),_:1}),i(v,{class:"manage-content"},{default:a((()=>[i(v,{class:"cu-list menu mt-15 bg-white"},{default:a((()=>[i(v,{class:"cu-item"},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o("仅群主和群管理员可以管理")])),_:1}),i(v,{class:"text-gray text-sm"},{default:a((()=>[o(" 启用后，其他成员不能修改群名称，编辑公告等")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(z,{class:c(["switch","1"==_.contact.setting.manage?"checked":""]),onChange:f.setManage,checked:"1"==_.contact.setting.manage},null,8,["onChange","class","checked"])])),_:1})])),_:1}),i(v,{class:"cu-item"},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o("允许群成员邀请")])),_:1}),i(v,{class:"text-gray text-sm"},{default:a((()=>[o("启用后，其他成员可以邀请其他人加入群聊")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(z,{class:c(["switch","1"==_.contact.setting.invite?"checked":""]),onChange:f.setInvite,checked:"1"==_.contact.setting.invite},null,8,["onChange","class","checked"])])),_:1})])),_:1}),i(v,{class:"cu-item"},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o("允许成员查看历史消息")])),_:1}),i(v,{class:"text-gray text-sm"},{default:a((()=>[o("启用后，新入群的成员可以查看所有的历史记录")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(z,{class:c(["switch","1"==_.contact.setting.history?"checked":""]),onChange:f.setHistory,checked:"1"==_.contact.setting.history},null,8,["onChange","class","checked"])])),_:1})])),_:1}),i(v,{class:"cu-item"},{default:a((()=>[i(v,{class:"content padding-tb-sm"},{default:a((()=>[i(v,null,{default:a((()=>[o("允许添加群成员为好友")])),_:1}),i(v,{class:"text-gray text-sm"},{default:a((()=>[o("启用后，成员可以互相查看资料并添加为好友或发消息")])),_:1})])),_:1}),i(v,{class:"action"},{default:a((()=>[i(z,{class:c(["switch","1"==_.contact.setting.profile?"checked":""]),onChange:f.setProfile,checked:"1"==_.contact.setting.profile},null,8,["onChange","class","checked"])])),_:1})])),_:1}),i(R,{title:"群聊禁言",type:"line"},{default:a((()=>[i(q,{class:"block",onChange:f.setSpeak},{default:a((()=>[(e(!0),x(A,null,b(_.radioList,(t=>(e(),s(v,{class:"cu-form-group"},{default:a((()=>[i(v,{class:"title"},{default:a((()=>[o(u(t.label),1)])),_:2},1024),i(F,{class:c(_.contact.setting.nospeak==t.value?"checked":""),checked:_.contact.setting.nospeak==t.value,value:t.value.toString()},null,8,["class","checked","value"])])),_:2},1024)))),256))])),_:1},8,["onChange"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1},8,["style"])):d("",!0)])),_:1})}],["__scopeId","data-v-58be5646"]]);export{V as default};
